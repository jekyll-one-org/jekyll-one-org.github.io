/*
 # -----------------------------------------------------------------------------
 # ~/assets/themes/j1/modules/speak2me/js/speak2me.min.js
 # speak2me v.1.0 implementation (based on Articulate.js) for J1 Theme
 #
 # Product/Info:
 # https://jekyll.one
 # https://github.com/acoti/articulate.js/tree/master
 #
 # Copyright (C) 2023 Juergen Adams
 # Copyright (C) 2017 Adam Coti
 #
 # J1 Theme is licensed under the MIT License.
 # See: https://github.com/jekyll-one-org/j1-template/blob/main/LICENSE.md
 # Articulate is licensed under the MIT License.
 # See: https://github.com/acoti/articulate.js/blob/master/LICENSE
 # -----------------------------------------------------------------------------
*/

/* Articulate.js (1.1.0). (C) 2017 Adam Coti.
  MIT @license: en.wikipedia.org/wiki/MIT_License
  See Github page at: https://github.com/acoti/articulate.js
  See Web site at: http://articulate.purefreedom.com
*/

!function(e){"use strict";var n,t,i,a,r,s,o=new Array,l=new Array,c=new Array,u=new Array,d=new Array,p=.9,h=1,f=.9,g=function(e){for(var n=e+"=",t=document.cookie.split(";"),i=0;i<t.length;i++){for(var a=t[i];" "===a.charAt(0);)a=a.substring(1,a.length);if(0===a.indexOf(n)){var r=a.substring(n.length,a.length);return r}}return}("googtrans"),m="Google UK English Female",v=/Edg/i.test(navigator.userAgent),y=/chrome/i.test(navigator.userAgent)&&!v,k=0,j=!1;function w(e,n){this.prepend=e,this.append=n}function b(e,n){this.name=e,this.language=n}function Q(){for(var e=speechSynthesis.getVoices(),n=0;n<e.length;n++)d.push(new b(e[n].name,e[n].lang))}if(Q(),"undefined"!=typeof speechSynthesis&&void 0!==speechSynthesis.onvoiceschanged&&(speechSynthesis.onvoiceschanged=Q),"speechSynthesis"in window){var S=new SpeechSynthesisUtterance;window.speechSynthesis.cancel()}if(void 0===g)a="en-US";else{var N=g.split("/");a="en"==N[2]?"en-GB":N[2].includes("ar")?"ar-EG":N[2].includes("cs")?"cs-CZ":N[2].includes("da")?"da-DK":N[2].includes("en")?"en-UK":N[2].includes("et")?"et-EE":N[2].includes("ka")?"ka-GE":N[2].includes("el")?"el-GR":N[2].includes("iw")?"he-IL":N[2].includes("hi")?"hi-IN":N[2].includes("ja")?"ja-JP":N[2].includes("zh")?"zh-CN":N[2]+"-"+N[2].toUpperCase()}if(y)var E={"de-DE":"Google Deutsch","en-US":"Google US English","en-GB":"Google UK English Female","es-ES":"Google español","fr-FR":"Google français","it-IT":"Google italiano","nl-NL":"Google Nederlands","pl-PL":"Google polski","pt-PT":"Google português do Brasil"}[a];if(v)E={"sq-AL":"Microsoft Anila Online (Natural) - Albanian (Albania)","ar-EG":"Microsoft Salma Online (Natural) - Arabic (Egypt)","bg-BG":"Microsoft Kalina Online (Natural) - Bulgarian (Bulgaria)","zh-CN":"Microsoft Xiaoxiao Online (Natural) - Chinese (Mainland)","hr-HR":"Microsoft Gabrijela Online (Natural) - Croatian (Croatia)","cs-CZ":"Microsoft Antonin Online (Natural) - Czech (Czech)","da-DK":"Microsoft Christel Online (Natural) - Danish (Denmark)","nl-NL":"Microsoft Colette Online (Natural) - Dutch (Netherlands)","en-GB":"Microsoft Libby Online (Natural) - English (United Kingdom)","en-US":"Microsoft Aria Online (Natural) - English (United States)","et-EE":"Microsoft Anu Online (Natural) - Estonian (Estonia)","fi-FI":"Microsoft Noora Online (Natural) - Finnish (Finland)","fr-FR":"Microsoft Denise Online (Natural) - French (France)","ka-GE":"Microsoft Giorgi Online (Natural) - Georgian (Georgia)","de-DE":"Microsoft Katja Online (Natural) - German (Germany)","el-GR":"Microsoft Athina Online (Natural) - Greek (Greece)","he-IL":"Microsoft Avri Online (Natural) - Hebrew (Israel)","hi-IN":"Microsoft Madhur Online (Natural) - Hindi (India)","hu-HU":"Microsoft Noemi Online (Natural) - Hungarian (Hungary)","it-IT":"Microsoft Elsa Online (Natural) - Italian (Italy)","ja-JP":"Microsoft Nanami Online (Natural) - Japanese (Japan)"}[a];var G={speak:function(a){e.extend({},e.fn.speak2me.defaults,a);var d,g,m,b,Q="",N=new Array;if(N.a=new w("clicking the link,",""),N.q=new w(",",""),N.ol=new w("Start of list.","End of list."),N.ul=new w("Start of list.","End of list."),N.dl=new w("Start of list.","End of list."),N.dt=new w("",", "),N.img=new w("There's an embedded image with the description,",""),N.table=new w("There's an embedded table with the caption,","Note, table contents are not spoken, "),N.figure=new w("There's an embedded figure with the caption,",""),N.blockquote=new w("Blockquote start.","Blockquote end."),b=["audio","button","canvas","code","del","dialog","embed","form","head","iframe","meter","nav","noscript","object","s","script","select","style","textarea","video"],"speechSynthesis"in window){if(!window.speechSynthesis.speaking)return this.each(function(){d=e(this).clone(),g=function(e){var n,t,i;if(l.length>0)for(var a in l){var r=b.indexOf(l[a]);r>-1&&b.splice(r,1)}for(var a in b)jQuery(e).find(b[a]).addBack(b[a]).not("[data-speak2me-recognize]").each(function(){jQuery(this).html("")});if(o.length>0)for(var a in o)jQuery(e).find(o[a]).addBack(o[a]).not("[data-speak2me-recognize]").each(function(){jQuery(this).html("")});jQuery(e).find("[data-speak2me-ignore]").addBack("[data-speak2me-ignore]").each(function(){jQuery(this).html("")}),jQuery(e).find(".speak2me-ignore").addBack("[data-speak2me-ignore]").each(function(){jQuery(this).html("")}),jQuery(e).find("[data-speak2me-prepend]").addBack("[data-speak2me-prepend]").each(function(){n=jQuery(this).data("speak2me-prepend"),jQuery(this).prepend(n+" ")}),jQuery(e).find("[data-speak2me-append]").addBack("[data-speak2me-append]").each(function(){n=jQuery(this).data("speak2me-append"),jQuery(this).append(" "+n)});for(var s in N)jQuery(e).find(s).each(function(){u[s]?(jQuery(this).prepend(u[s].prepend+" "),jQuery(this).append(" "+u[s].append)):(jQuery(this).prepend(N[s].prepend+" "),jQuery(this).append(" "+N[s].append))});return jQuery(e).find("h1,h2,h3,h4,h5,h6,li,p").addBack("h1,h2,h3,h4,h5,h6,li,p").each(function(){jQuery(this).append(". ")}),jQuery(e).find("br").each(function(){jQuery(this).after(", ")}),jQuery(e).find("figure").addBack("figure").each(function(){n=jQuery(this).find("figcaption").html(),i=u.figure?u.figure.prepend:N.figure.prepend,null!=n&&""!==n&&jQuery("<div>"+i+" "+n+".</div>").insertBefore(this),jQuery(this).remove()}),jQuery(e).find("img").addBack("img").each(function(){n=jQuery(this).attr("alt");var e=jQuery(this).parent(),t=e.get(0).tagName;i=u.img?u.img.prepend:N.img.prepend,void 0!==n&&""!=n&&("PICTURE"==t?jQuery("<div>"+i+" "+n+".</div>").insertBefore(e):jQuery("<div>"+i+" "+n+".</div>").insertBefore(this)),jQuery(this).remove()}),jQuery(e).find("table").addBack("table").each(function(){n=jQuery(this).find("caption").text(),u.table?(i=u.table.prepend,t=u.table.append):(i=N.table.prepend,t=N.table.append),void 0!==n&&""!=n&&(jQuery("<div>"+i+" "+n+".</div>").insertBefore(this),jQuery("<div>"+t+" .</div>").insertBefore(this)),jQuery(this).remove()}),jQuery(e).find("[data-speak2me-swap]").addBack("[data-speak2me-swap]").each(function(){n=jQuery(this).data("speak2me-swap"),jQuery(this).text(n)}),jQuery(e).find("[data-speak2me-spell]").addBack("[data-speak2me-spell]").each(function(){n=(n=jQuery(this).text()).split("").join(" "),jQuery(this).text(n)}),e}(d),g=jQuery(g).html(),m=function(e){var n,t,i,a,s;for(;-1!=e.indexOf("\x3c!-- <speak2me>")&&(n=e.indexOf("\x3c!-- <speak2me>"),-1!=(t=e.indexOf("</speak2me> --\x3e",n)));)i=e.substring(n+17,t),a=e.substring(0,n),s=e.substring(t+17),e=a+" "+i+" "+s;e=(e=e.replace(/<!--[\s\S]*?-->/g,"")).replace(/(<([^>]+)>)/gi,"");var o,l,d=c.length,p=0;for(;p<d;){o=(o=c[p]).replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),l=c[p+1]+" ";var h=new RegExp(o,"gi"),e=e.replace(h,l);p+=2}e=u.q?(e=e.replace(/“/g,u.q.prepend+" ")).replace(/”/g," "+u.q.append):(e=e.replace(/“/g,N.q.prepend+" ")).replace(/”/g," "+N.q.append);e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace(/:/g,", ")).replace(/^$/g,"\n")).replace(/^\s+$/g,"\n")).replace(/\s+\.\s+/g,"\n")).replace(/\s+\.\s+$/g,"\n")).replace(/\.\./g,".")).replace(/\se\.g\.\s/g," for example, ")).replace(/\,\s+\.g\.\s+\,/g," for example, ")).replace(/[\!\?]/g,", ")).replace(/—/g,", ")).replace(/--/g,", ");var f=document.createElement("textarea");f.innerHTML=e;const g=function(e,n){const t=e.split(/[.!?]/);return t.forEach((e,n)=>{t[n]=e.replace(/^\s+|\s+$/g,""),t[n]=t[n]+". "}),t}(e=(e=(e=(e=(e=(e=(e=f.value).replace(/(\r\n|\n|\r)/gm,"")).replace(/  +/g," ")).replace(/\.\./g,".")).replace(/,,/g,",")).replace(/ ,/g,",")).replace(/^\s+|\s+$/g,""));return r=g.length,g}(g),Q=m}),p=void 0!==n?n:.9,h=void 0!==t?t:1,f=void 0!==i?i:.9,(S=new SpeechSynthesisUtterance).rate=p,S.pitch=h,S.volume=f,S.voice=void 0,y&&(S.voice=speechSynthesis.getVoices().filter(function(e){return e.name==E})[0]),v&&(S.voice=speechSynthesis.getVoices().filter(function(e){return e.name==E})[0]),function(n,t){const i=window.speechSynthesis;n.text=t[k],i.speak(n),n.addEventListener("start",n=>{e(".mdib-speaker").addClass("mdib-spin")}),n.addEventListener("end",function(n){k++,e(s).removeClass("speak-highlighted")});var a=setInterval(function(){if(!i.speaking)if(k==r||j)k=0,j=!1,i.cancel(),e(".mdib-speaker").removeClass("mdib-spin"),clearInterval(a);else{n.text=t[k];var o=n.text.substr(0,20);s=e("#content").find("p:contains('"+o+"')")[0],e(s).addClass("speak-highlighted"),i.speak(n)}},500)}(S,Q),S}else alert("Sorry, this browser does not support the Web Speech API.")},pause:function(){return window.speechSynthesis.pause(),this},resume:function(){return window.speechSynthesis.resume(),this},stop:function(){return window.speechSynthesis.cancel(),j=!0,this},enabled:function(){return"speechSynthesis"in window},isSpeaking:function(){return window.speechSynthesis.speaking},isPaused:function(){return window.speechSynthesis.paused},rate:function(){var e=arguments[0];return e>=.1&&e<=10?n=e:void 0===e&&(n=void 0,p=.9),this},pitch:function(){var e=arguments[0];return e>=.1&&e<=2?t=e:void 0===e&&(t=void 0,h=1),this},volume:function(){var e=arguments[0];return e>=0&&e<=1?i=e:void 0===e&&(i=void 0,f=.9),this},ignore:function(){var e=arguments.length;for(o.length=0;e>0;)e--,o.push(arguments[e]);return this},recognize:function(){var e=arguments.length;for(l.length=0;e>0;)e--,l.push(arguments[e]);return this},replace:function(){var e=arguments.length;c.length=0;for(var n=0;n<e&&(c.push(arguments[n],arguments[n+1]),e-(n+=2)!=1););return this},customize:function(){var e=arguments.length;if(0==e&&(u=[]),2==e){if(-1==["img","table","figure"].indexOf(arguments[0]))return void console.log("Error: When customizing, tag indicated must be either 'img', 'table', or 'figure'.");u[arguments[0].toString()]=new w(arguments[1].toString())}if(3==e){if(-1==["q","ol","ul","blockquote"].indexOf(arguments[0]))return void console.log("Error: When customizing, tag indicated must be either 'q', 'ol', 'ul' or 'blockquote'.");u[arguments[0].toString()]=new w(arguments[1].toString(),arguments[2].toString())}return this},getVoices:function(){if(0==arguments.length)return d;var e=jQuery(arguments[0]),n="Choose a voice";void 0!==arguments[1]&&(n=arguments[1]),e.append(jQuery("<select id='voiceSelect' name='voiceSelect'><option value='none'>"+n+"</option></select>"));for(var t=0,i=0;i<d.length;i++)if(y&&d[i].name.includes("Microsoft"))t++;else if(!v||d[i].name.includes("Natural")){var a=document.createElement("option");a.textContent=d[i].name+" ("+d[i].language+")",a.setAttribute("value",d[i].name),void 0!==E?d[i].name===E&&a.setAttribute("selected","selected"):d[i].name.includes(m),a.setAttribute("data-speak2me-language",d[i].language),e.find("select").append(a)}else t++;return i-t},setVoice:function(){if(arguments.length<2)return this;var e,n;if("name"==arguments[0]){e=arguments[1];for(var t=0;t<d.length;t++)d[t].name==e&&(m=e)}if("language"==arguments[0])if(2==(n=arguments[1].toUpperCase()).length){for(t=0;t<d.length;t++)if(d[t].language.substring(0,2).toUpperCase()==n){m=d[t].name;break}}else for(t=0;t<d.length;t++)if(d[t].language==n){m=d[t].name;break}return this}};e.fn.speak2me=function(e){return G[e]?G[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?void jQuery.error("Method "+e+" does not exist on jQuery.speak2me"):G.speak.apply(this,arguments)}}(jQuery);
