/*
 # -----------------------------------------------------------------------------
 # ~/assets/themes/j1/modules/backstretch/js/backstretch.min.js
 # Backstretch v.2.1.16 implementation for J1 Theme.
 #
 # Product/Info:
 # https://jekyll.one
 # http://srobbin.com/jquery-plugins/backstretch/
 #
 # Copyright (C) 2022 Juergen Adams
 # Copyright (C) 2017 Daniel Cohen Gindi
 # Copyright (C) 2012 Scott Robbin
 #
 # J1 Theme is licensed under the MIT License.
 # See: https://github.com/jekyll-one-org/j1-template/blob/main/LICENSE.md
 # Backstretch is licensed under the MIT License.
 # See: https://github.com/danielgindi/jquery-backstretch
 # -----------------------------------------------------------------------------
*/
"use strict";!function(t,e,i){var r,o=/^.*(youtu\.be\/|youtube\.com\/v\/|youtube\.com\/embed\/|youtube\.com\/watch\?v=|youtube\.com\/watch\?.*\&v=)([^#\&\?]*).*/i;t.fn.backstretch=function(r,o){var a,n=arguments;return 0===t(e).scrollTop()&&e.scrollTo(0,0),this.each(function(e){var s=t(this),h=s.data("backstretch");if(h){if("string"==typeof n[0]&&"function"==typeof h[n[0]]){var c=h[n[0]].apply(h,Array.prototype.slice.call(n,1));c===h&&(c=i),c!==i&&((a=a||[])[e]=c);return}o=t.extend(h.options,o),h.hasOwnProperty("destroy")&&h.destroy(!0)}if(!r||r&&0===r.length){var d=s.css("background-image");d&&"none"!==d?r=[{url:s.css("backgroundImage").replace(/url\(|\)|"|'/g,"")}]:t.error("No images were supplied for Backstretch, or element must have a CSS-defined background image.")}h=new b(this,r,o||{}),s.data("backstretch",h)}),a?1===a.length?a[0]:a:this},t.backstretch=function(e,i){return t("body").backstretch(e,i).data("backstretch")},t.expr[":"].backstretch=function(e){return i!==t(e).data("backstretch")},t.fn.backstretch.defaults={debug:!1,duration:5e3,transition:"fade",transitionDuration:0,animateFirst:!0,alignX:.5,alignY:.5,paused:!1,start:0,preload:2,preloadSize:1,resolutionRefreshRate:2500,resolutionChangeRatioThreshold:.1};var a,n,s,h,c,d,l={wrap:{left:0,top:0,overflow:"hidden",margin:0,padding:0,height:"100%",width:"100%",zIndex:-999999},itemWrapper:{position:"absolute",display:"none",margin:0,padding:0,border:"none",width:"100%",height:"100%",zIndex:-999999},item:{position:"absolute",margin:0,padding:0,border:"none",width:"100%",height:"100%",maxWidth:"none"}},u=(a=function(t){for(var e=1;e<t.length;e++){for(var i=t[e],r=e;t[r-1]&&parseInt(t[r-1].width,10)>parseInt(i.width,10);)t[r]=t[r-1],--r;t[r]=i}return t},n=function(t,i,r){var o=e.devicePixelRatio||1,a=S();X();for(var n,s,h=i>t?"portrait":t>i?"landscape":"square",c=0,d=0;d<r.length&&("string"==typeof(s=r[d])&&(s=r[d]={url:s}),s.pixelRatio&&"auto"!==s.pixelRatio&&parseFloat(s.pixelRatio)!==o||s.deviceOrientation&&s.deviceOrientation!==a||s.windowOrientation&&s.windowOrientation!==a||s.orientation&&s.orientation!==h||(c=d,n=t,"auto"===s.pixelRatio&&(t*=o),!(s.width>=n)));d++);return r[Math.min(d,c)]},s=function(t,e){if("string"==typeof t)t=t.replace(/{{(width|height)}}/g,e);else if(t instanceof Array)for(var i=0;i<t.length;i++)t[i].src?t[i].src=s(t[i].src,e):t[i]=s(t[i],e);return t},function(e,i){for(var r=e.width(),o=e.height(),h=[],c=function(t,e){return"width"===e?r:"height"===e?o:t},d=0;d<i.length;d++)if(t.isArray(i[d])){i[d]=a(i[d]);var l=n(r,o,i[d]);h.push(l)}else{"string"==typeof i[d]&&(i[d]={url:i[d]});var u=t.extend({},i[d]);u.url=s(u.url,c),h.push(u)}return h}),p=function(t){return o.test(t.url)||t.isVideo},g=(h=[],c=function(t){for(var e=0;e<h.length;e++)if(h[e].src===t.src)return h[e];return h.push(t),t},d=function(t,e,i){"function"==typeof e&&e.call(t,i)},function e(i,r,o,a,n){if(void 0!==i){t.isArray(i)||(i=[i]),arguments.length<5&&"function"==typeof arguments[arguments.length-1]&&(n=arguments[arguments.length-1]),r="function"!=typeof r&&r?r:0,o="function"==typeof o||!o||o<0?i.length:Math.min(o,i.length),a="function"!=typeof a&&a?a:1,r>=i.length&&(r=0,o=0),a<0&&(a=o),a=Math.min(a,o);var s,h=i.slice(r+a,o-a);if(!(o=(i=i.slice(r,a)).length)){d(i,n,!0);return}for(var l=0,u=function(){++l===o&&(d(i,n,!h),e(h,0,0,a,n))},g=0;g<i.length;g++)!p(i[g])&&((s=new Image).src=i[g].url,(s=c(s)).complete?u():t(s).on("load error",u))}}),f=function(e){for(var i=[],r=0;r<e.length;r++)"string"==typeof e[r]?i.push({url:e[r]}):t.isArray(e[r])?i.push(f(e[r])):i.push(y(e[r]));return i},y=function(t,r){return(t.centeredX||t.centeredY)&&(e.console&&e.console.log&&e.console.log("jquery.backstretch: `centeredX`/`centeredY` is deprecated, please use `alignX`/`alignY`"),t.centeredX&&(t.alignX=.5),t.centeredY&&(t.alignY=.5)),i!==t.speed&&(e.console&&e.console.log&&e.console.log("jquery.backstretch: `speed` is deprecated, please use `transitionDuration`"),t.transitionDuration=t.speed,t.transition="fade"),i!==t.resolutionChangeRatioTreshold&&(e.console.log("jquery.backstretch: `treshold` is a typo!"),t.resolutionChangeRatioThreshold=t.resolutionChangeRatioTreshold),i!==t.fadeFirst&&(t.animateFirst=t.fadeFirst),i!==t.fade&&(t.transitionDuration=t.fade,t.transition="fade"),t.scale&&(t.scale=$(t.scale)),v(t)},v=function(t,e){return"left"===t.alignX?t.alignX=0:"center"===t.alignX?t.alignX=.5:"right"===t.alignX?t.alignX=1:(i!==t.alignX||e)&&(t.alignX=parseFloat(t.alignX),isNaN(t.alignX)&&(t.alignX=.5)),"top"===t.alignY?t.alignY=0:"center"===t.alignY?t.alignY=.5:"bottom"===t.alignY?t.alignY=1:(i!==t.alignX||e)&&(t.alignY=parseFloat(t.alignY),isNaN(t.alignY)&&(t.alignY=.5)),t},m={cover:"cover",fit:"fit","fit-smaller":"fit-smaller",fill:"fill"};function $(t){return m.hasOwnProperty(t)?t:"cover"}var b=function(i,r,o){this.options=t.extend({},t.fn.backstretch.defaults,o||{}),this.firstShow=!0,y(this.options,!0),this.images=f(t.isArray(r)?r:[r]),this.options.paused&&(this.paused=!0),this.options.start>=this.images.length&&(this.options.start=this.images.length-1),this.options.start<0&&(this.options.start=0),this.isBody=i===document.body;var a=t(e);this.$container=t(i),this.$root=this.isBody?H?a:t(document):this.$container,this.originalImages=this.images,this.images=u(this.options.alwaysTestWindowResolution?a:this.$root,this.originalImages),g(this.images,this.options.start||0,this.options.preload||1);var n=this.$container.children(".backstretch").first();if(this.$wrap=n.length?n:t('<div class="backstretch"></div>').css(this.options.bypassCss?{}:l.wrap).appendTo(this.$container),!this.options.bypassCss){if(!this.isBody){var s=this.$container.css("position"),h=this.$container.css("zIndex");this.$container.css({position:"static"===s?"relative":s,zIndex:"auto"===h?0:h}),this.$wrap.css({zIndex:-999998})}this.$wrap.css({position:this.isBody&&H?"fixed":"absolute"})}this.index=this.options.start,this.show(this.index),a.on("resize.backstretch",t.proxy(this.resize,this)).on("orientationchange.backstretch",t.proxy(function(){this.isBody&&0===e.pageYOffset&&(e.scrollTo(0,1),this.resize())},this))},w=function(e){var r=e.transition||"fade";"string"==typeof r&&r.indexOf("|")>-1&&(r=r.split("|")),r instanceof Array&&(r=r[Math.round(Math.random()*(r.length-1))]);var o=e.new,a=e.old?e.old:t([]);switch(r.toString().toLowerCase()){default:case"fade":o.fadeIn({duration:e.duration,complete:e.complete,easing:e.easing||i});break;case"fadeinout":case"fade_in_out":var n=function(){o.fadeIn({duration:e.duration/2,complete:e.complete,easing:e.easing||i})};a.length?a.fadeOut({duration:e.duration/2,complete:n,easing:e.easing||i}):n();break;case"pushleft":case"push_left":case"pushright":case"push_right":case"pushup":case"push_up":case"pushdown":case"push_down":case"coverleft":case"cover_left":case"coverright":case"cover_right":case"coverup":case"cover_up":case"coverdown":case"cover_down":var s=r.match(/^(cover|push)_?(.*)$/),h="left"===s[2]?"right":"right"===s[2]?"left":"down"===s[2]?"top":"up"===s[2]?"bottom":"right",c={display:""},d={};if(c[h]="-100%",d[h]=0,o.css(c).animate(d,{duration:e.duration,complete:function(){o.css(h,""),e.complete.apply(this,arguments)},easing:e.easing||i}),"push"===s[1]&&a.length){var l={};l[h]="100%",a.animate(l,{duration:e.duration,complete:function(){a.css("display","none")},easing:e.easing||i})}}};b.prototype={resize:function(){try{var o,a,n=log4javascript.getLogger("j1.core.attic"),s=this.options.alwaysTestWindowResolution?t(e):this.$root,h=s.width(),c=s.height(),d=h/(this._lastResizeContainerWidth||0),l=c/(this._lastResizeContainerHeight||0),p=this.options.resolutionChangeRatioThreshold||0;if((h!==this._lastResizeContainerWidth||c!==this._lastResizeContainerHeight)&&(Math.abs(d-1)>=p||isNaN(d)||Math.abs(l-1)>=p||isNaN(l))&&(this._lastResizeContainerWidth=h,this._lastResizeContainerHeight=c,this.images=u(s,this.originalImages),this.options.preload&&g(this.images,(this.index+1)%this.images.length,this.options.preload),1===this.images.length&&this._currentImage.url!==this.images[0].url)){var f=this;clearTimeout(f._selectAnotherResolutionTimeout),f._selectAnotherResolutionTimeout=setTimeout(function(){f.show(0)},this.options.resolutionRefreshRate)}var y={left:0,top:0,right:"auto",bottom:"auto"},v=this.isBody?this.$root.width():this.$root.innerWidth(),m=this.isBody?e.innerHeight?e.innerHeight:this.$root.height():this.$root.innerHeight(),b=this.$itemWrapper.data("width"),w=this.$itemWrapper.data("height"),_=b/w||1,x=i===this._currentImage.alignX?this.options.alignX:this._currentImage.alignX,k=i===this._currentImage.alignY?this.options.alignY:this._currentImage.alignY,W=$(this._currentImage.scale||this.options.scale);if(this.options.debug&&(r="\nresize: boxHeight x boxWidth: "+m+" x "+v,n.debug(r)),"fit"===W||"fit-smaller"===W){if(o=b,a=w,o>v||a>m||"fit-smaller"===W){var T=v/m;T>_?(o=Math.floor(m*_),a=m):T<_?(o=v,a=Math.floor(v/_)):(o=v,a=m)}}else"fill"===W?(o=v,a=m):(o=Math.max(m*_,v),a=Math.max(o/_,m));y.top=-(a-m)*k,y.left=-(o-v)*x,y.width=o,y.height=a,this.options.bypassCss||this.$wrap.css({width:v,height:m}).find(">.backstretch-item").not(".deleteable").each(function(){t(this).find("img,video,iframe").css(y)});var R=t.Event("backstretch.resize",{relatedTarget:this.$container[0]});this.$container.trigger(R,this)}catch(Y){r="resize: jadams, IE7 hack to let it fail gracefully: "+Y,n.warn(r)}return this},show:function(e,r){var o=log4javascript.getLogger("j1.core.attic");if(!(Math.abs(e)>this.images.length-1)){var a=this,n=a.$wrap.find(">.backstretch-item").addClass("deleteable"),s=a.videoWrapper,h={relatedTarget:a.$container[0]};a.$container.trigger(t.Event("backstretch.before",h),[a,e]),this.index=e;var c=a.images[e];clearTimeout(a._cycleTimeout),delete a.videoWrapper;var d=p(c);return d?(a.videoWrapper=new _(c),a.$item=a.videoWrapper.$video.css("pointer-events","none")):a.$item=t("<img />"),a.$itemWrapper=t('<div class="backstretch-item">').append(a.$item),this.options.bypassCss?a.$itemWrapper.css({display:"none"}):(a.$itemWrapper.css(l.itemWrapper),a.$item.css(l.item)),a.$item.bind(d?"canplay":"load",function(c){var l=t(this).parent(),u=l.data("options");r&&(u=t.extend({},u,r));var p=this.naturalWidth||this.videoWidth||this.width,g=this.naturalHeight||this.videoHeight||this.height;l.data("width",p).data("height",g);var f=function(t){return i!==u[t]?u[t]:a.options[t]},y=f("transition"),v=f("transitionEasing"),m=f("transitionDuration"),$=function(){s&&(s.stop(),s.destroy()),n.remove(),!a.paused&&a.images.length>1&&a.cycle(),a.options.bypassCss||a.isBody,t(["before","after","show"]).each(function(){a.$container.trigger(t.Event("backstretch."+this,h),[a,e])}),d&&a.videoWrapper.play()};(!a.firstShow||a.options.animateFirst)&&m&&y?w({new:l,old:n,transition:y,duration:m,easing:v,complete:$}):(l.show(),$()),a.firstShow=!1;var b=this.naturalWidth||this.videoWidth||this.width,_=this.naturalHeight||this.videoHeight||this.height;a.options.debug&&o.debug("show: imageHeight x imageWidth: "+_+" x "+b);var x="#"+a.$container["0"].id,k=setInterval(function(){t(x).is(":visible")&&(clearInterval(k),o.debug("\ncontainer visible on id: "+x),a.resize())},50)}),a.$itemWrapper.appendTo(a.$wrap),a.$item.attr("alt",c.alt||""),a.$itemWrapper.data("options",c),d||a.$item.attr("src",c.url),a._currentImage=c,a}},current:function(){return this.index},next:function(){var t=Array.prototype.slice.call(arguments,0);return t.unshift(this.index<this.images.length-1?this.index+1:0),this.show.apply(this,t)},prev:function(){var t=Array.prototype.slice.call(arguments,0);return t.unshift(0===this.index?this.images.length-1:this.index-1),this.show.apply(this,t)},pause:function(){return this.paused=!0,this.videoWrapper&&this.videoWrapper.pause(),this},resume:function(){return this.paused=!1,this.videoWrapper&&this.videoWrapper.play(),this.cycle(),this},cycle:function(){if(this.images.length>1){clearTimeout(this._cycleTimeout);var e=this._currentImage&&this._currentImage.duration||this.options.duration,i=p(this._currentImage),r=function(){this.$item.off(".cycle"),this.paused||this.next()};if(i){if(!this._currentImage.loop){var o=0;this.$item.on("playing.cycle",function(){var e=t(this).data("player");clearTimeout(o),void 0!==e&&(o=setTimeout(function(){e.pause(),e.$video.trigger("ended")},(e.getDuration()-e.getCurrentTime())*1e3))}).on("ended.cycle",function(){clearTimeout(o)})}this.$item.on("error.cycle initerror.cycle",t.proxy(r,this))}i&&!this._currentImage.duration?this.$item.on("ended.cycle",t.proxy(r,this)):this._cycleTimeout=setTimeout(t.proxy(r,this),e)}return this},destroy:function(i){t(e).off("resize.backstretch orientationchange.backstretch"),this.videoWrapper&&this.videoWrapper.destroy(),clearTimeout(this._cycleTimeout),i||this.$wrap.remove(),this.$container.removeData("backstretch")}};var _=function(){this.init.apply(this,arguments)};_.prototype.init=function(r){var a,n=this,s=function(){n.$video=a,n.video=a[0]},h="video";if(!(r.url instanceof Array)&&o.test(r.url)&&(h="youtube"),n.type=h,"youtube"===h){_.loadYoutubeAPI(),n.ytId=r.url.match(o)[2];var c="https://www.youtube.com/embed/"+n.ytId+"?rel=0&autoplay=0&showinfo=0&controls=0&modestbranding=1&cc_load_policy=0&disablekb=1&iv_load_policy=3&loop=0&enablejsapi=1&origin="+encodeURIComponent(e.location.origin);n.__ytStartMuted=!!r.mute||i===r.mute,a=t("<iframe />").attr({src_to_load:c}).css({border:0,margin:0,padding:0}).data("player",n),r.loop&&a.on("ended.loop",function(){n.__manuallyStopped||n.play()}),n.ytReady=!1,s(),e.YT?(n._initYoutube(),a.trigger("initsuccess")):t(e).one("youtube_api_load",function(){n._initYoutube(),a.trigger("initsuccess")})}else{a=t("<video>").prop("autoplay",!1).prop("controls",!1).prop("loop",!!r.loop).prop("muted",!!r.mute||i===r.mute).prop("preload","auto").prop("poster",r.poster||"");for(var d=r.url instanceof Array?r.url:[r.url],l=0;l<d.length;l++){var u=d[l];"string"==typeof u&&(u={src:u}),t("<source>").attr("src",u.src).attr("type",u.type||null).appendTo(a)}a[0].canPlayType&&d.length?a.trigger("initsuccess"):a.trigger("initerror"),s()}},_.prototype._initYoutube=function(){var i=this,r=e.YT;i.$video.attr("src",i.$video.attr("src_to_load")).removeAttr("src_to_load");var o=!!i.$video[0].parentNode;if(!o){var a=t("<div>").css("display","none !important").appendTo(document.body);i.$video.appendTo(a)}var n=new r.Player(i.video,{events:{onReady:function(){i.__ytStartMuted&&n.mute(),o||(i.$video[0].parentNode===a[0]&&i.$video.detach(),a.remove()),i.ytReady=!0,i._updateYoutubeSize(),i.$video.trigger("canplay")},onStateChange:function(t){switch(t.data){case r.PlayerState.PLAYING:i.$video.trigger("playing");break;case r.PlayerState.ENDED:i.$video.trigger("ended");break;case r.PlayerState.PAUSED:i.$video.trigger("pause");break;case r.PlayerState.BUFFERING:i.$video.trigger("waiting");break;case r.PlayerState.CUED:i.$video.trigger("canplay")}},onPlaybackQualityChange:function(){i._updateYoutubeSize(),i.$video.trigger("resize")},onError:function(t){i.hasError=!0,i.$video.trigger({type:"error",error:t})}}});return i.ytPlayer=n,i},_.prototype._updateYoutubeSize=function(){var t=this;switch(t.ytPlayer.getPlaybackQuality()||"medium"){case"small":t.video.videoWidth=426,t.video.videoHeight=240;break;case"medium":t.video.videoWidth=640,t.video.videoHeight=360;break;default:case"large":t.video.videoWidth=854,t.video.videoHeight=480;break;case"hd720":t.video.videoWidth=1280,t.video.videoHeight=720;break;case"hd1080":t.video.videoWidth=1920,t.video.videoHeight=1080;break;case"highres":t.video.videoWidth=2560,t.video.videoHeight=1440}return t},_.prototype.play=function(){var t=this;return t.__manuallyStopped=!1,"youtube"===t.type?t.ytReady&&(t.$video.trigger("play"),t.ytPlayer.playVideo()):t.video.play(),t},_.prototype.pause=function(){var t=this;return t.__manuallyStopped=!1,"youtube"===t.type?t.ytReady&&t.ytPlayer.pauseVideo():t.video.pause(),t},_.prototype.stop=function(){var t=this;return t.__manuallyStopped=!0,"youtube"===t.type?t.ytReady&&(t.ytPlayer.pauseVideo(),t.ytPlayer.seekTo(0)):(t.video.pause(),t.video.currentTime=0),t},_.prototype.destroy=function(){return this.ytPlayer&&this.ytPlayer.destroy(),this.$video.remove(),this},_.prototype.getCurrentTime=function(t){return"youtube"!==this.type?this.video.currentTime:this.ytReady?this.ytPlayer.getCurrentTime():0},_.prototype.setCurrentTime=function(t){var e=this;return"youtube"===e.type?e.ytReady&&e.ytPlayer.seekTo(t,!0):e.video.currentTime=t,e},_.prototype.getDuration=function(){return"youtube"!==this.type?this.video.duration:this.ytReady?this.ytPlayer.getDuration():0},_.loadYoutubeAPI=function(){if(!e.YT){t("script[src*=www\\.youtube\\.com\\/iframe_api]").length||t('<script type="text/javascript" src="https://www.youtube.com/iframe_api">').appendTo("body");var i=setInterval(function(){e.YT&&e.YT.loaded&&(t(e).trigger("youtube_api_load"),clearTimeout(i))},50)}};var x,k,W,T,R,Y,I,P,C,z,S=function(){if("matchMedia"in e){if(e.matchMedia("(orientation: portrait)").matches)return"portrait";if(e.matchMedia("(orientation: landscape)").matches)return"landscape"}return screen.height>screen.width?"portrait":"landscape"},X=function(){return e.innerHeight>e.innerWidth?"portrait":e.innerWidth>e.innerHeight?"landscape":"square"},H=(x=navigator.userAgent,k=navigator.platform,T=!!(W=x.match(/AppleWebKit\/([0-9]+)/))&&W[1],Y=!!(R=x.match(/Fennec\/([0-9]+)/))&&R[1],P=!!(I=x.match(/Opera Mobi\/([0-9]+)/))&&I[1],z=!!(C=x.match(/MSIE ([0-9]+)/))&&C[1],!((k.indexOf("iPhone")>-1||k.indexOf("iPad")>-1||k.indexOf("iPod")>-1)&&T&&T<534||e.operamini&&"[object OperaMini]"===({}).toString.call(e.operamini)||I&&P<7458||x.indexOf("Android")>-1&&T&&T<533||Y&&Y<6||"palmGetResource"in e&&T&&T<534||x.indexOf("MeeGo")>-1&&x.indexOf("NokiaBrowser/8.5.0")>-1||z&&z<=6))}(jQuery,window);
