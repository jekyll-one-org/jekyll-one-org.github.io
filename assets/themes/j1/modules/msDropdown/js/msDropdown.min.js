/*
 # -----------------------------------------------------------------------------
 # ~/assets/themes/j1/modules/msDropdown/js/msDropdown.min.js
 # Provides JS Core and API for MSDropdown
 #
 # Product/Info:
 # http://jekyll.one
 # https://www.marghoobsuleman.com/
 #
 # Copyright (C) 2022 Juergen Adams
 #
 # msDropdown is licensed under MIT License.
 # See: https://github.com/marghoobsuleman/ms-Dropdown/blob/master/MIT-LICENSE.txt
 # J1 Template is licensed under MIT License.
 # See: https://github.com/jekyll-one/J1 Template/blob/master/LICENSE
 # -----------------------------------------------------------------------------
 # NOTE:
 # https://github.com/marghoobsuleman/ms-Dropdown
 # https://www.marghoobsuleman.com/image-dropdown/help
 # https://www.marghoobsuleman.com/image-dropdown/advanced-help
 # -----------------------------------------------------------------------------

/*!
 * /**
 *  * MSDropdown - msDropdown.js
 *  * @author: Marghoob Suleman
 *  * @website: https://www.marghoobsuleman.com/
 *  * @version: 4.0.2
 *  * @date: Sun Oct 24 2021 10:46:05 GMT+0200 (GMT+02:00)
 *  * msDropdown is free web component: you can redistribute it and/or modify
 *  * it under the terms of the either the MIT License or the Gnu General Public License (GPL) Version 2
 *  * /
 */(()=>{"use strict";var e={};let t=null;class s{constructor(e,t){let s={byJson:{data:null,selectedIndex:0,name:null,size:0,multiple:false,width:250},mainCss:"ms-dd",rowHeight:null,visibleRows:null,showIcon:true,zIndex:9999,event:"click",style:"",childWidth:null,childHeight:null,enableCheckbox:false,checkboxNameSuffix:"_mscheck",showPlusItemCounter:true,enableAutoFilter:true,showFilterAlways:false,showListCounter:false,imagePosition:"left",errorMessage:"Please select an item from this list",on:{create:null,open:null,close:null,add:null,remove:null,change:null,blur:null,click:null,dblclick:null,mousemove:null,mouseover:null,mouseout:null,focus:null,mousedown:null,mouseup:null}};this.ele=e;this._settings={...s,...t};this._css={};this._onDocumentClick=null;this._onDocumentKeyDown=null;this._onDocumentKeyUp=null;this._isOpen=false;this._DOWN_ARROW=40;this._UP_ARROW=38;this._LEFT_ARROW=37;this._RIGHT_ARROW=39;this._ESCAPE=27;this._ENTER=13;this._ALPHABETS_START=47;this._SHIFT=16;this._CONTROL=17;this._MAC_CONTROL=91;this._BACKSPACE=8;this._DELETE=46;this._SPACE=32;this._shiftHolded=false;this._controlHolded=false;this._isFirstTime=true;this._cacheEle={};this._isMouseDown=false;this._itemsArr=[];this._css={dd:this._settings.mainCss+" ms-pr",wrapperDisabled:"disabled",headerA:"ms-list-option option-selected",header:"ms-dd-header",headerMiddleContent:"ms-header-middle-content",arrow:"ms-dd-arrow",arrowDown:"ms-dd-pointer-down",arrowUp:"ms-dd-pointer-up",headerCounter:"ms-header-counter",listOfItems:"ms-options",itemContent:"ms-dd-option-content",item:"ms-list-option",itemSpan:"ms-middle",itemSpanOpt:"ms-optgroup-padding",itemLabel:"ms-dd-label",itemImage:"ms-dd-option-image",itemDesc:"ms-dd-desc",itemSelected:"option-selected",itemDisabled:"disabled",itemEnabled:"enabled",optgroup:"ms-optgroup",listCounter:"ms-list-counter",valueInput:"ms-value-input",checkbox:"ms-checkbox",imageRight:"ico-align-right"};this._wrapper={};this._createByJson();this._checkDataSettings();this._isList=this.ele.size>1;this._isMultiple=this.ele.multiple;this._enableCheckbox=this._settings.enableCheckbox;if(this._isList||this._enableCheckbox.toString()==="true"){this._isMultiple=this.ele.multiple=true}this._isFilterApplied=false;this._nexPrevCounter=0;this._init()}_init(){this._makeLayout();this._updateUiAndValueByIndex(this.selectedIndex);if(this.ele.size>1){this._makeUiAsList(true,this.ele.size);this._scrollToItem()}if(this._settings.childWidth!==null){this._wrapper.listOfItems.style.width=this._settings.childWidth}this._showHideOriginal(false);if(this._settings.showFilterAlways.toString()==="true"){this._settings.enableAutoFilter=true;this._showHideFilterBox(true)}if(this.ele.autofocus){this._wrapper.holder.focus();this._wrapper.filterInput.focus()}else{this._wrapper.filterInput.blur()}this.updateUiAndValue();this._fireLocalEventIfExist("create");this._fireEventIfExist("onCreate")}_showHideOriginal(e=true){if(e){this._show(this.ele)}else{this._hide(this.ele)}}_checkDataSettings(){let e=this._getDataSet(this.ele);let t=this._settings;t.mainCss=e?.mainCss||t.mainCss;t.showIcon=e?.showIcon||t.showIcon;t.event=e?.event||t.event;t.childWidth=e?.childWidth||t.childWidth;t.childHeight=e?.childHeight||t.childHeight;t.enableCheckbox=e?.enableCheckbox||t.enableCheckbox;t.checkboxNameSuffix=e?.checkboxNameSuffix||t.checkboxNameSuffix;t.enableAutoFilter=e?.enableAutoFilter||t.enableAutoFilter;t.visibleRows=e?.visibleRows||t.visibleRows;t.showPlusItemCounter=e?.showPlusItemCounter||t.showPlusItemCounter;t.errorMessage=e?.errorMessage||t.errorMessage;t.showFilterAlways=e?.showFilterAlways||t.showFilterAlways;t.showListCounter=e?.showListCounter||t.showListCounter;t.imagePosition=e?.imagePosition||t.imagePosition;this._settings={...this._settings,...t}}setSettingAttribute(e,t){this._settings[e]=t}_createByJson(){if(this._settings.byJson.data){try{let e=this._settings.byJson;let t={};t.name=e.name||this.ele.id||"";if(e.size>0){t.size=e.size}if(e.multiple){t.multiple=e.multiple}let s=this._createEle("select",t);let i=e.data.length;for(let t=0;t<i;t++){let i=e.data[t];let l=new Option(i.text,i.value);if(i.disabled){l.disabled=true}for(let e in i){if(i.hasOwnProperty(e)&&e.toLowerCase()!=="text"){let t=`data-${e}`;t=t.replace(/([A-Z])/g,"-$1").toLowerCase();l.setAttribute(t,i[e])}}s.options[t]=l}this.ele.appendChild(s);s.selectedIndex=e.selectedIndex;if(e.width){this.ele.style.width=e.width+"px"}this.ele=s}catch(e){throw"There is an error in json data."}}}_scrollToItem(e,t="smooth"){e=e||this.uiData.ui;if(e){e=e.length>1?e[0]:e;this._scrollToIfNeeded(e)}}_showHideFilterBox(e=true){if(e){this._show(this._wrapper.filterHolder);this._wrapper.filterInput.focus();if(this._settings.showFilterAlways.toString()==="false"){this._hide(this._wrapper.headerA)}}else{this._wrapper.filterInput.value="";this._hide(this._wrapper.filterHolder);this._show(this._wrapper.headerA)}}_applyFilters(e){let t=this._wrapper.filterInput.value;if(t.length===0){this._show(this._wrapper.headerA);this._makeChildren();this._isFilterApplied=false}else{if(this._settings.showFilterAlways.toString()==="false"){this._hide(this._wrapper.headerA)}if(!this._isOpen){this.open(null)}let e=[...this.options];let s=e.filter((function(e){return e.nodeName!=="OPTGROUP"&&e.disabled===false&&e.text.toLowerCase().indexOf(t.toLowerCase())>=0}));this._makeChildren(s);this._isFilterApplied=true;this._nexPrevCounter=-1;this._scrollToIfNeeded(null,0)}}_makeFilterBox(){let e=this._createEle("div",{className:"ms-filter-box"});let t=this._createEle("input",{type:"text"});e.appendChild(t);this._wrapper.filterInput=t;this._wrapper.filterHolder=e;this._bindEvents(t,"input",(e=>{this._applyFilters(e)}));return e}_makeHeader(){let e=this._css;let t=this._createEle("div",{className:e.header});let s=this._createEle("a",{className:e.headerA});let i=this._createEle("span",{className:e.headerMiddleContent});let l=this._createEle("span",{className:e.arrow+" "+e.arrowDown});s.appendChild(l);s.appendChild(i);t.appendChild(s);this._wrapper.header=t;this._wrapper.headerA=s;this._wrapper.headerContent=i;this._wrapper.arrow=l;if(this._settings.imagePosition!=="left"){s.classList.add(e.imageRight)}this._bindEvents(t,this._settings.event,(e=>{this.open(e)}));return t}_makeChildren(e=null){let t=this._css;let s=this._enableCheckbox.toString()==="true";let i,l=this;let n=function(e,i){let n={};n=l._parseOption(e);let r={label:{text:n.text,css:t.itemLabel},img:{src:n.image,css:t.itemImage},desc:{text:n.description,css:t.itemDesc},isDisabled:e.disabled||false,isSelected:e.selected||false,isCheckbox:s,value:n.value,title:n.title,imageCss:`${n.imageCss} ${n.className}`,counter:i+1,isOptGroup:e.nodeName==="OPTGROUP",innerSpanCss:t.itemContent};return{opt:n,itemObj:r}};let r=function(e,t){if(!t.isDisabled){l._bindEvents(e,"mouseup",(e=>{l._isMouseDown=false;if(!s||e.target.nodeName!=="INPUT"){if(!l._isList){l.close(e)}}}));l._bindEvents(e,"mousedown",(t=>{l._isMouseDown=true;if(!s||t.target.nodeName!=="INPUT"){if(l._shiftHolded&&l._isMultiple){let t=l.selectedIndex;let s=e.index;l._setSelectedByIndexFromTo(t,s)}else if(l._controlHolded&&l._isMultiple){l._setSelectedByItem(e,false,false)}else{l._setSelectedByItem(e)}}else{l._setSelectedByItemToggle(e._refCheckbox,e)}}));l._bindEvents(e,"mouseover",(t=>{if(l._isMouseDown&&l._isMultiple){l._setSelectedByItem(e,false,false)}}))}};if(!this._wrapper.listOfItems){i=this._createEle("ul",{className:t.listOfItems,zIndex:this._settings.zIndex});this._wrapper.listOfItems=i}else{i=this._wrapper.listOfItems}i.innerHTML="";let a=e===null?this.ele.children:e;let h=a.length;for(let e=0;e<h;e++){let s=a[e];let l=n(s,e);let h=l.opt;let d=l.itemObj;let o=this._createRow(d);if(h.className!==""){o.className=o.className+" "+h.className}if(h.internalStyle!==""){o.style=h.internalStyle}o.index=h.index;o.setAttribute("data-ms-index",h.index);if(d.isOptGroup){let e=s.children;let i=e.length;let l=this._createEle("ul");for(let s=0;s<i;s++){let i=e[s];let a=n(i,s);let h=a.opt;let d=a.itemObj;let o=this._createRow(d);if(h.className!==""){o.className=o.className+" "+h.className}if(h.internalStyle!==""){o.style=h.internalStyle}o.index=h.index;o.setAttribute("data-ms-index",h.index);if(d.isSelected){this._setSelectedByItem(o,true)}r(o,d);if(this._settings.imagePosition!=="left"){o.classList.add(t.imageRight)}l.appendChild(o)}o.appendChild(l)}if(!d.isOptGroup){r(o,d)}if(this._settings.imagePosition!=="left"){o.classList.add(t.imageRight)}i.appendChild(o);if(d.isSelected){this._setSelectedByItem(o,true)}}if(this._settings.childHeight!==null){i.style.maxHeight=this._settings.childHeight+"px"}return i}_makeLayout(){this.ele.tabIndex=-1;let e=this._css;let s=this._createEle("div",{tabIndex:0,className:e.dd});let i=this.ele.name;let l=this.ele.required;let n=this._createEle("input",{tabIndex:-1,name:i,type:"text",className:this._css.valueInput,required:l});s.appendChild(n);this.ele.required=false;this.ele.name="";let r=this._createEle("div",{className:"more",style:"display:none"});s.appendChild(r);this._wrapper.valueBox=n;this._wrapper.moreValueBox=r;let a=this._makeHeader();let h=this._makeFilterBox();a.appendChild(h);this._showHideFilterBox(false);let d=this._makeChildren();s.appendChild(a);s.appendChild(d);this._wrapper.holder=s;this._insertAfter(s,this.ele);this._hide(d);if(this.disabled){s.classList.add(e.wrapperDisabled)}let o=this._getInternalStyle(this.ele);s.setAttribute("style",o);if(this._settings.byJson.data!==null){s.setAttribute("style",`width:${this._settings.byJson.width}px`)}let u=this._createEle("div",{style:"clear:both"});s.appendChild(u);this._bindEvents(this._wrapper.holder,"focus",(e=>{if(this._isList){this._bindDocumentEvents(null,false,true)}else{if(t){t.close(null);t=null}this._bindDocumentEvents(null,true,true);t=this}this._fireLocalEventIfExist("focus");this._fireEventIfExist("focus")}));this._bindEvents(this._wrapper.holder,"blur",(e=>{if(this._isList){this._unbindDocumentEvents()}this._fireLocalEventIfExist("blur");this._fireEventIfExist("blur")}));this._bindEvents(this._wrapper.holder,"dblclick",(e=>{this._fireLocalEventIfExist("blur");this._fireEventIfExist("blur")}));this._bindEvents(n,"invalid",(e=>{e.target.setCustomValidity("");if(!e.target.validity.valid){e.target.setCustomValidity(this._settings.errorMessage)}}));this._bindEvents(n,"input",(e=>{e.target.setCustomValidity("")}));let _=["click","dblclick","mousemove","mouseover","mouseout","mousedown","mouseup"];for(let e=0,t=_.length;e<t;e++){let t=_[e];this._bindEvents(this._wrapper.holder,t,(e=>{this._fireLocalEventIfExist(t);this._fireEventIfExist(t)}))}return s}_createRow(e){let t=e.isOptGroup?this._css.optgroup:this._css.item;let s=this._createEle("li",{className:t});if(e.isCheckbox&&!e.isOptGroup){let t=this._createEle("input",{tabIndex:-1,className:this._css.checkbox,type:"checkbox",disabled:e.isDisabled,checked:false,value:e.value,name:this._wrapper.valueBox.name+this._settings.checkboxNameSuffix+"[]"});s.appendChild(t);s._refCheckbox=t}let i=e.isOptGroup?" "+this._css.itemSpanOpt:"";let l=this._createEle("span",{className:this._css.itemSpan+i});let n=this._settings.showListCounter.toString()==="true"?`<span class='${this._css.listCounter}'>${e.counter}</span> ${e.label.text}`:e.label.text;let r=this._createEle("span",{className:e.label.css},n);let a=this._createEle("span",{className:e.innerSpanCss});a.appendChild(r);if(e.img.src!==null){let t=this._createEle("img",{className:e.img.css,src:e.img.src});l.appendChild(t)}if(e.img.src===null&&e.imageCss.replace(/\s/g,"")!==""){let t=this._createEle("span",{className:e.img.css+" "+e.imageCss},"&nbsp;");l.appendChild(t)}if(e.desc.text!==null){let t=this._createEle("span",{className:e.desc.css},e.desc.text);a.appendChild(t)}l.appendChild(a);s.appendChild(l);if(e.isDisabled){s.classList.add(this._css.itemDisabled)}else if(!e.isOptGroup){s.classList.add(this._css.itemEnabled)}if(e.title!==""){s.title=e.title}return s}_parseOption(e){let t=null,s="",i="",l="",n="",r="",a="",h=-1,d,o,u;if(e!==undefined){let _=e.nodeName;let p=e.dataset;if(_==="OPTGROUP"){n=e.label}else{n=e.text;l=e.value||n}h=e.index;d=e.selected;o=e.disabled;r=e.className||"";s=p.title||"";i=p.description||"";t=p.image||t;a=p.imageCss||"";u=this._getInternalStyle(e)}return{image:t,title:s,description:i,value:l,text:n,className:r,imageCss:a,index:h,selected:d,disabled:o,internalStyle:u}}_removeOldSelected(){let e=this._getAllEle("ul li."+this._css.itemSelected,this._wrapper.holder);for(let t=0;t<e.length;t++){e[t].classList.remove(this._css.itemSelected);if(this._isMultiple&&this._enableCheckbox.toString()==="true"){e[t]._refCheckbox.checked=false}}}_setSelectedByIndexFromTo(e,t){let s=Math.min(e,t);let i=Math.max(e,t);let l=this.optionsUI;for(let e=s;e<=i;e++){this._setSelectedByItem(l[e],false,false)}}_setSelectedByItemToggle(e,t){let s=!e.checked;let i=t.index;if(s){t.classList.add(this._css.itemSelected);this.ele.options[i].selected=true}else{t.classList.remove(this._css.itemSelected);this.ele.options[i].selected=false}this.updateUiAndValue()}_setSelectedByItem(e,t=false,s=true){if(t&&e){e.classList.add(this._css.itemSelected)}else{let t=e.index;if(s===true){this._removeOldSelected();this.ele.selectedIndex=t}else{this.ele.options[t].selected=true}e?.classList?.add(this._css.itemSelected);this.updateUiAndValue()}if(this._enableCheckbox.toString()==="true"){if(e?._refCheckbox){e._refCheckbox.checked=true}}if(this._isFirstTime===false){this._fireLocalEventIfExist("change");this._fireEventIfExist("change")}this._isFirstTime=false}_setSelectedByOptionItem(e,t=false){let s=e.index;let i=this._getDataAndUI(s);this._setSelectedByItem(i.ui,t)}_updateHeaderUI(e=null,t=null){let s=e===null?this.uiData:e;let i=this._isArray(s.index)?s.ui[0].innerHTML:null;this._wrapper.headerContent.innerHTML=t!==null?t:i||s?.ui?.innerHTML||"&nbsp;";let l=this._getEle("."+this._css.itemLabel,this._wrapper.headerContent);if(this._settings.showPlusItemCounter.toString()==="true"&&s.ui!==null&&s.ui.length>1){l.innerHTML=l.innerHTML+`<span class="${this._css.headerCounter}">&nbsp; (+${s.ui.length-1})</span>`}if(this._settings.showIcon.toString()==="false"){let e=this._getEle("img",this._wrapper.headerContent);if(e){this._hide(e)}}this._setTitleMinHeight(false)}_findElementByIndexProp(e){let t=this._getAllEle(`ul li.${this._css.item}`,this._wrapper.holder);let s=t.length;for(let i=0;i<s;i++){let s=t[i];if(s.index===e){return t[i]}}return null}_getDataAndUI(e=null){let t=this.ele;let s,i,l=null,n=-1;let r,a=this;let h=false;let d=function(e){let s=t.options[e];let i=a._parseOption(s);let l=e;let n=a._findElementByIndexProp(l);return{option:s,data:i,index:l,ui:n}};if(e!==null){r=d(e);l=r.option;s=r.data;n=r.index;i=r.ui}else{i=this._getAllEle("ul li."+this._css.itemSelected,this._wrapper.holder);if(i.length>1){let e=[],t=[],a=[],o=[];for(let s=0;s<i.length;s++){r=d(i[s].index);e.push(r.data);t.push(r.option);a.push(r.index);o.push(r.ui)}s=e;l=t;n=a;i=o;h=true}else{r=d(i[0]?.index||this.selectedIndex);l=r.option||null;s=r.data||null;n=r.index||-1;i=r.ui||null}}return{data:s,ui:i,index:n,option:l,isArray:h}}_isArray=function(e){return Object.prototype.toString.call(e)==="[object Array]"};updateUiAndValue(e=null){let t=e===null?this.uiData:e;this._updateHeaderUI(t);let s=this._wrapper.valueBox;s.value=this.ele.value;if(this._isMultiple&&s.name.substr(s.name.length-2,s.name.length)==="[]"){this._wrapper.moreValueBox.innerHTML="";for(let e=1;e<t.data.length;e++){let i=this._createEle("input",{type:"hidden",name:s.name,value:t.data[e].value});this._wrapper.moreValueBox.appendChild(i)}}}_updateUiAndValueByIndex(e){let t=this._getDataAndUI(e);this.updateUiAndValue(t)}_createEle(e,t,s){let i=document.createElement(e);if(t){for(let e in t){if(e==="style"){i.style.cssText=t[e]}else{i[e]=t[e]}}}if(s){i.innerHTML=s}return i}_getEle(e,t=null){return t===null?document.querySelector(e):t.querySelector(e)}_getAllEle(e,t=null){return t===null?document.querySelectorAll(e):t.querySelectorAll(e)}_getInternalStyle(e){return e.style===undefined?"":e.style.cssText}_toggleShow(e){e.style.display=e.style.display==="none"||e.style.display===""?"inherit":"none"}_show(e,t="block"){e.style.display=t}_hide(e){e.style.display="none"}_insertAfter(e,t){return t.parentNode.insertBefore(e,t.nextSibling)}_insertBefore(e,t){return t.insertBefore(e,t)}_getIndex(e){let t=this._getAllEle("ul li",this._wrapper.holder);return[...t].indexOf(e)}_getProp(e,t){let s={};for(let i=0;i<e.attributes.length;i++){let l=e.attributes[i].nodeName;let n=e.attributes[i].nodeValue;if(t===l){return n}s[l]=n}return typeof t==="undefined"?s:null}_getDataSet(e,t=null){return t===null?e.dataset:e.dataset[t]||null}_bindEvents(e,t,s){e.addEventListener(t,s)}_unbindEvents(e,t,s){e.removeEventListener(t,s)}_adjustChildHeight(e=null){e=e===null?parseInt(this._settings.visibleRows):e;if(e!==null){let t=this._getEle("li[data-ms-index='0']",this._wrapper.listOfItems);let s=this._settings.rowHeight!==null?this._settings.rowHeight:t.clientHeight;this._wrapper.listOfItems.style.height=e*s+"px"}}_setTitleMinHeight(e=true){let t=0;if(e===true){let e=this._getAllEle("li",this._wrapper.listOfItems);let s=e.length;for(let i=0;i<s;i++){let s=e[i];t=s.clientHeight>t?s.clientHeight:t}}else{t=this._wrapper.headerA.clientHeight}this._wrapper.header.style.minHeight=t+"px"}_makeUiAsList(e,t){if(e===true){this._hide(this._wrapper.header);this.open(null,true);this._adjustChildHeight(t);this._wrapper.listOfItems.style.position="relative";this._wrapper.listOfItems.style.display="inline-block";this._wrapper.listOfItems.style.zIndex=0;this._wrapper.holder.style.zIndex=0;this._isList=true}else{this._show(this._wrapper.header);this._wrapper.listOfItems.style.height=null;this._wrapper.listOfItems.style.position="absolute";this._wrapper.listOfItems.style.zIndex=this._settings.zIndex;this._wrapper.holder.style.zIndex=0;this._isList=false;this.close(null)}}_bindDocumentEvents(e,t=true,s=true){this._unbindDocumentEvents();this._onDocumentClick=e=>{let t=this._wrapper.listOfItems.getBoundingClientRect();let s=this._wrapper.header.getBoundingClientRect();let i=t.left+t.width;let l=s.top+t.height+s.height;if(e.clientX<t.left||e.clientX>i||e.clientY<s.y||e.clientY>l){this.close(e)}};this._onDocumentKeyDown=e=>{switch(e.keyCode){case this._DOWN_ARROW:case this._RIGHT_ARROW:e.preventDefault();e.stopPropagation();this._show(this._wrapper.listOfItems);this._isOpen=true;this.next();break;case this._UP_ARROW:case this._LEFT_ARROW:e.preventDefault();e.stopPropagation();this.previous();break;case this._ESCAPE:case this._ENTER:e.preventDefault();e.stopPropagation();this.close(null);break;case this._SHIFT:this._shiftHolded=true;break;case this._CONTROL:case this._MAC_CONTROL:this._controlHolded=true;break;case this._SPACE:this._show(this._wrapper.listOfItems);this._isOpen=true;break;default:if(e.keyCode>=this._ALPHABETS_START&&this._isList===false&&this._settings.enableAutoFilter.toString()==="true"){this._showHideFilterBox(true)}this._shiftHolded=false;this._controlHolded=false;break}};this._onDocumentKeyUp=e=>{this._shiftHolded=false;this._controlHolded=false};if(t===true){this._bindEvents(document,"mouseup",this._onDocumentClick)}if(s===true){this._bindEvents(document,"keydown",this._onDocumentKeyDown);this._bindEvents(document,"keyup",this._onDocumentKeyUp)}}_unbindDocumentEvents(){if(this._onDocumentClick!==null){this._unbindEvents(document,"mouseup",this._onDocumentClick)}if(this._onDocumentKeyDown!==null){this._unbindEvents(document,"keydown",this._onDocumentKeyDown)}if(this._onDocumentKeyUp!==null){this._unbindEvents(document,"keyup",this._onDocumentKeyUp)}this._onDocumentClick=null;this._onDocumentKeyDown=null;this._onDocumentKeyUp=null}_scrollToIfNeeded(e=null,t=null,s="next"){let i=this._wrapper.listOfItems;let l=i.getBoundingClientRect();if(e===null&&t!==null){i.scrollTop=t}e=e!==undefined?e:this._getEle("li."+this._css.itemSelected);if(e){let t=e.offsetTop;let l=i.clientHeight;let n=e.clientHeight;if(t+n-i.scrollTop>l&&s==="next"){i.scrollTop=t+n-l}else if(t-i.scrollTop<0&&s==="previous"){i.scrollTop=t}}}_fireLocalEventIfExist(e,t=null){if(typeof this._settings.on[e]==="function"){let s=t===null?this._getDataAndUI():t;let i=this._settings.on[e];try{i(s)}catch(e){console.error(e.message)}}}_fireEventIfExist(e){if(this.ele.dataset[e]){let t=new Function(this.ele.dataset[e]);try{t()}catch(e){console.error(e.message)}}if(this._has_handler(e).hasEvent){if(this._has_handler(e).byElement){try{this.ele[e]()}catch(t){try{this.ele["on"+e]()}catch(e){}}}else if(this._has_handler(e).byJQuery){switch(e){case"keydown":case"keyup":break;default:try{if(typeof jQuery!=="undefined"){jQuery(this.ele).triggerHandler(e)}}catch(e){}break}}return false}}_has_handler(e){let t={byElement:false,local:false,byJQuery:false,hasEvent:false};if(this._settings.on[e]!==null){t.hasEvent=true;t.local=true}try{if(this._getProp(this.ele,"on"+e)!==null){t.hasEvent=true;t.byElement=true}}catch(e){}if(typeof jQuery!=="undefined"){let s=jQuery(this.ele);let i;if(typeof jQuery?._data==="function"){i=jQuery?._data(this.ele,"events")}else{i=s.data("events")}if(i&&i[e]){t.hasEvent=true;t.byJQuery=true}}return t}add(e,t=null){let s,i,l,n,r,a;let h;if(e instanceof HTMLOptionElement){h=e}else if(typeof e==="string"){s=i=e;h=new Option(s,i)}else if(e instanceof Object){s=e.text||"";i=e.value||s;l=e.title||"";n=e.image||"";a=e.imageCss||"";r=e.description||"";h=new Option(s,i);h.setAttribute("data-description",r);h.setAttribute("data-image",n);h.setAttribute("data-title",l);h.setAttribute("data-image-css",a)}this.ele.add(h,t);this._makeChildren();this._fireLocalEventIfExist("add")}remove(e){let t=this._getDataAndUI(e);this.ele.remove(e);this._makeChildren();this._fireLocalEventIfExist("remove",t);return t}next(){let e=this;let t=this.optionsUI;let s=t.length;let i;if(this._isFilterApplied){i=this._nexPrevCounter}else{i=this.selectedIndex}let l=function(){let l=i;for(l;l<s;l++){let i=l+1;i=i>=s?s-1:i;e._nexPrevCounter++;if(!t[i].classList.contains(e._css.itemDisabled)){return t[i]}}return null};if(s>0){let e=l();if(e){this._setSelectedByItem(e,false,true);this._scrollToIfNeeded(e)}}}previous(){let e=this;let t=this.optionsUI;let s=t.length;let i;if(this._isFilterApplied){i=this._nexPrevCounter}else{i=this.selectedIndex}let l=function(s){let l=i;for(l;l>0;l--){let s=l-1;s=s>=0?s:0;e._nexPrevCounter--;if(!t[s].classList.contains(e._css.itemDisabled)){return t[s]}}return null};if(t.length>0){let e=l();if(e){this._setSelectedByItem(e,false,true);this._scrollToIfNeeded(e,null,"previous")}}}open(e,t=false){if(this.disabled){return}if(!this._isOpen){this._isOpen=true;this._show(this._wrapper.listOfItems);if(t===false){this._bindDocumentEvents(e)}this._wrapper.arrow.classList.remove(this._css.arrowDown);this._wrapper.arrow.classList.add(this._css.arrowUp);this._adjustChildHeight();this._scrollToItem();this._fireLocalEventIfExist("open")}else{this.close(null)}}close(e){let t=this._isList;let s=false;if(e!==null){e.stopImmediatePropagation();let t=e.target.closest("li");s=t!==null?t.classList.contains("disabled"):false}if(this.disabled||t||s){return}this._scrollToIfNeeded(null,0);this._hide(this._wrapper.listOfItems);this._wrapper.arrow.classList.add(this._css.arrowDown);this._wrapper.arrow.classList.remove(this._css.arrowUp);this._isOpen=false;this._isMouseDown=false;this._shiftHolded=false;this._controlHolded=false;this._isFilterApplied=false;this._wrapper.filterInput.value="";this._wrapper.filterInput.blur();if(this._settings.showFilterAlways.toString()==="false"){this._showHideFilterBox(false)}this._applyFilters();this._unbindDocumentEvents();this._updateHeaderUI();if(this.ele.length!==this._getAllEle(`li.${this._css.item}`,this._wrapper.listOfItems).length){this._makeChildren();this.updateUiAndValue()}this._fireLocalEventIfExist("close")}namedItem(e,t=false){let s=null;let i=this.ele.querySelector(`option[name='${e}']`);if(i&&t){s={};let e=this._parseOption(i);s.option=i;s.data=e}else{s=i}return s}item(e,t=false){let s=null;let i=this.ele.options[e];if(i&&t){s={};let e=this._parseOption(i);s.option=i;s.data=e}else{s=i}return s}visible(e=null){if(e===true){this._show(this._wrapper.holder,"inline-block")}else if(e===false){this._hide(this._wrapper.holder)}if(e===null){return this._wrapper.holder.style.display!=="none"}}showRows(e){this._settings.visibleRows=e>this.length?this.length:e;this._adjustChildHeight()}visibleRows(e){this.showRows(e)}on(e,t){this._settings.on[e]=t}off(e,t){this._settings.on[e]=null}refresh(){this._makeChildren();this.updateUiAndValue()}destroy(){this._show(this.ele);this.ele.required=this._wrapper.valueBox.required;this.ele.name=this._wrapper.valueBox.name;this._wrapper.holder.parentNode.removeChild(this._wrapper.holder)}get selectedIndex(){return this.ele.selectedIndex}set selectedIndex(e){let t=this;let s=function(e){t.ele.selectedIndex=e;if(e===-1){t._updateHeaderUI(null,"");t._removeOldSelected()}else{t._setSelectedByOptionItem(t.ele.options[e])}};if(e<this.length&&!this._isArray(e)){s(e)}else{if(this._isMultiple&&this._isArray(e)){for(let t=0,s=e.length;t<s;t++){if(e[t]<this.length&&e[t]!==-1){this._setSelectedByOptionItem(this.ele.options[e[t]],t>0)}}this._updateHeaderUI(null)}else{s(e)}}}get options(){return this.ele.options}set options(e){if(e instanceof HTMLOptionElement){this.ele.add(e);this._makeChildren();this.updateUiAndValue()}else if(typeof e==="number"){this.ele.length=e;this._makeChildren();this.updateUiAndValue()}}get optionsUI(){if(this._cacheEle["allItems"]){}return this._cacheEle["allItems"]=this._getAllEle(`li.${this._css.item}`,this._wrapper.listOfItems)}get length(){return this.ele.length}set length(e){this.ele.options.length=e;this._makeChildren();this.updateUiAndValue()}get value(){return this.ele.value}set value(e){this.ele.value=e;this.selectedIndex=this.ele.selectedIndex}get selectedText(){return this.selectedIndex>=0?this.ele.options[this.selectedIndex].text:""}get disabled(){return this.ele.hasAttribute("disabled")}set disabled(e){if(e){this.ele.setAttribute("disabled","");this._wrapper.holder.classList.add(this._css.wrapperDisabled)}else{this.ele.removeAttribute("disabled");this._wrapper.holder.classList.remove(this._css.wrapperDisabled)}}get form(){return this.ele.form}get multiple(){return this.ele.multiple}set multiple(e){if(e){this.ele.setAttribute("multiple","");this._enableCheckbox=this._settings.enableCheckbox}else{this.ele.removeAttribute("multiple")}this._isMultiple=e;if(!e){this.selectedIndex=this.ele.selectedIndex;this._enableCheckbox=false}this._makeChildren()}get name(){if(this._wrapper?.valueBox){return this._wrapper.valueBox.name||""}return this.ele.name}set name(e){if(this._wrapper?.valueBox){this._wrapper.valueBox.name=e}else{this.ele.name=e}}get required(){return this._wrapper.valueBox.required}set required(e){if(e){this._wrapper.valueBox.setAttribute("required",true)}else{this._wrapper.valueBox.removeAttribute("required")}}get size(){return this.ele.size}set size(e){this.ele.size=e;this._makeUiAsList(e>1,e)}get selectedOptions(){let e=null;if(this.selectedIndex>=0){e=this.ele.options[this.selectedIndex];if(this.multiple){e=[];let t=this.options;let s=t.length;for(let i=0;i<s;i++){if(t[i].selected){e.push(t[i])}}e=e.length===1?e[0]:e}}return e}get children(){return this.ele.children}get uiData(){return this._getDataAndUI()}get version(){return"4.0.3"}}class i{constructor(e,t){if(typeof e==="string"){document.querySelectorAll(e).forEach((e=>{new i(e,t)}))}else{e.msDropdown=this;this._ddMaker=new s(e,t)}}setSettingAttribute(e,t,s=false){this._ddMaker.setSettingAttribute(e,t);if(s){this._ddMaker.refresh()}}add(e,t){this._ddMaker.add(e,t)}remove(e){return this._ddMaker.remove(e)}next(){this._ddMaker.next()}previous(){this._ddMaker.previous()}open(){this._ddMaker.open(null,false)}close(){this._ddMaker.close(null)}namedItem(e,t=false){return this._ddMaker.namedItem(e,t)}item(e,t=false){return this._ddMaker.item(e,t)}visible(e=null){return this._ddMaker.visible(e)}showRows(e){this._ddMaker.showRows(e)}visibleRows(e){this._ddMaker.showRows(e)}on(e,t){this._ddMaker.on(e,t)}off(e,t){this._ddMaker.off(e,t)}updateUiAndValue(){this._ddMaker.updateUiAndValue()}refresh(){this._ddMaker.refresh()}destroy(){this._ddMaker.destroy()}get selectedIndex(){return this._ddMaker.selectedIndex}set selectedIndex(e){this._ddMaker.selectedIndex=e}get options(){return this._ddMaker.options}set options(e){this._ddMaker.options=e}get optionsUI(){return this._ddMaker.optionsUI}get length(){return this._ddMaker.length}set length(e){this._ddMaker.length=e}get value(){return this._ddMaker.value}set value(e){this._ddMaker.value=e}get selectedText(){return this._ddMaker.selectedText}get disabled(){return this._ddMaker.disabled}set disabled(e){this._ddMaker.disabled=e}get form(){return this._ddMaker.form}get multiple(){return this._ddMaker.multiple}set multiple(e){this._ddMaker.multiple=e}get name(){return this._ddMaker.name}set name(e){this._ddMaker.name=e}get required(){return this._ddMaker.required}set required(e){this._ddMaker.required=e}get size(){return this._ddMaker.size}set size(e){this._ddMaker.size=e}get selectedOptions(){return this._ddMaker.selectedOptions}get children(){return this._ddMaker.children}get uiData(){return this._ddMaker.uiData}static make(e,t){if(!e.msDropdown){try{let s=new i(e,t);e.addEventListener("change",(()=>{if(!e.multiple){e.msDropdown.selectedIndex=current.selectedIndex}else{e.msDropdown.refresh()}}));return s}catch(e){console.log(e.message)}}}static get version(){return"4.0.3"}static get author(){return"Marghoob Suleman"}}class l extends HTMLSelectElement{constructor(e,t){super()}connectedCallback(){setTimeout((()=>{if(!this.msDropdown){this.msDropdown=new i(this)}try{this.addEventListener("change",(e=>{if(!this.multiple){this.msDropdown.selectedIndex=this.selectedIndex}else{this.msDropdown.refresh()}}))}catch(e){console.log(e.message)}}),1)}disconnectedCallback(){}adoptedCallback(){}attributeChangedCallback(e,t,s){if(this.msDropdown){if(e.indexOf("data-")!==-1){e=e.replace("data-","");let t=e.toLowerCase().split("-");for(let e=1;e<t.length;e++){t[e]=t[e].charAt(0).toUpperCase()+t[e].substring(1)}this.msDropdown.setSettingAttribute(t.join(""),s,true)}else{}}console.log("attributeChangedCallback")}static get observedAttributes(){return["data-main-css","data-show-icon","data-event","data-child-width","data-child-height","data-enable-checkbox","data-checkbox-name-suffix","data-enable-auto-filter","data-visible-rows","data-show-plus-item-counter","data-error-message","data-show-filter-always","data-show-list-counter","data-image-position"]}}customElements.define("ms-dropdown",l,{extends:"select"});window.MsDropdown=i;(function(){let e=navigator.vendor&&navigator.vendor.indexOf("Apple")>-1&&navigator.userAgent&&navigator.userAgent.indexOf("CriOS")==-1&&navigator.userAgent.indexOf("FxiOS")==-1;if(e){i.make("select[is='ms-dropdown']")}})()})();
