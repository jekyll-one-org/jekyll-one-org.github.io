/*
 # -----------------------------------------------------------------------------
 # ~/assets/themes/j1/modules/translator/js/translator.min.js
 # Provides JS Core functions|API for J1 Module Translator
 #
 #  Product/Info:
 #  http://jekyll.one
 #
 #  Copyright (C) 2021 Juergen Adams
 #
 #  J1 Template is licensed under MIT License.
 #  See: https://github.com/jekyll-one/J1 Template/blob/master/LICENSE
 # -----------------------------------------------------------------------------
*/
function Translator(o){function e(){var o={},t=!1,n=0,a=arguments.length;"[object Boolean]"===Object.prototype.toString.call(arguments[0])&&(t=arguments[0],n++);for(var i=function(n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t&&"[object Object]"===Object.prototype.toString.call(n[a])?o[a]=e(!0,o[a],n[a]):o[a]=n[a])};a>n;n++){var s=arguments[n];i(s)}return o}function t(o,e){for(var t=Array.prototype.slice.call(arguments,2),n=o.split("."),a=n.pop(),i=0;i<n.length;i++)e=e[n[i]];return e[a].apply(e,t)}function n(o){var t,n=e({size:0,width:250,multiple:!1,selectedIndex:1,enableAutoFilter:!1,visibleRows:null},o);t="#"+n.selector,$.ajax({url:n.url,dataType:"json",success:function(o){var e=[];if(u.props.translationLanguages.includes("all"))e=o[n.elm];else for(var a=0;a<o[n.elm].length;a++)u.props.translationLanguages.includes(o[n.elm][a].value)&&e.push(o[n.elm][a]);n.visibleRows>e.length&&(n.visibleRows=e.length),MsDropdown.make(t,{byJson:{data:e,name:n.name,size:n.size,width:n.width,multiple:n.multiple},enableAutoFilter:n.enableAutoFilter,visibleRows:n.visibleRows})},error:function(o,e,t){m.error("\nfailed to retrieve JSON data from: "+n.url)}})}function a(){k.documentReady(function(){if(u.modal=document.getElementById(u.props.dialogContainerID),u.modal)u.$modal.modal("show");else{m.info("\nload consent modal"),u.modal=document.createElement("div"),u.modal.id=u.props.dialogContainerID,u.modal.setAttribute("class","modal fade"),u.modal.setAttribute("tabindex","-1"),u.modal.setAttribute("role","dialog"),u.modal.setAttribute("aria-labelledby",u.props.dialogContainerID),document.body.append(u.modal),u.$modal=$(u.modal),u.$modal.on("show.bs.modal",function(){m.info("\nshow.bs.modal: entered"),$.when(n({url:"/assets/data/iso-639-language-codes-flags.json",elm:"iso-639-languages",selector:"dropdownJSON",width:400,visibleRows:8})).then(function(o){m.info("\ncreating msDropdown from JSON data: finished")})}),u.$modal.on("shown.bs.modal",function(){var o=document.getElementById("dropdownJSON").msDropdown;o.length?("auto"===u.props.translationLanguage?(p=navigator.language||navigator.userLanguage,g=p.split("-")[0]):g=u.props.translationLanguage,o.selectedIndex=$("#dropdownJSON option[value="+g+"]").index(),u.props.disableLanguageSelector&&(o.disabled=!0),$("#dropdownJSON").show(),$("body").addClass("stop-scrolling")):(m.error("\nno msDropdown found in translation dialog"),u.$modal.hide())}),u.$modal.on("hidden.bs.modal",function(){$("body").removeClass("stop-scrolling"),t(u.props.postSelectionCallback,window)});var o=u.props.contentURL+"/index.html";$.get(o).done(function(o){m.info("\nloading consent modal: successfully"),u.modal.innerHTML=o,u.modal.innerHTML=$("#"+u.props.xhrDataElement).eq(0).html(),$(u.modal).modal({backdrop:"static",keyboard:!1}),u.$buttonDoNotAgree=$("#translator-buttonDoNotAgree"),u.$buttonAgree=$("#translator-buttonAgree"),u.$buttonSave=$("#translator-buttonSave"),u.$buttonAgreeAll=$("#translator-buttonAgreeAll"),m.info("\nload/initialze options from cookie"),s(),i(),$("#google-options").on("hide.bs.collapse",function(){b=!1,s()}).on("show.bs.collapse",function(){b=!0,s()}),m.info("\ninitialze button event handler"),u.$buttonDoNotAgree.click(function(){d()}),u.$buttonAgree.click(function(){l()}),u.$buttonSave.click(function(){$("#google-options").collapse("hide"),c(),i()}),u.$buttonAgreeAll.click(function(){$("#google-options").collapse("hide"),l()})}).fail(function(){m.error("\nloading translator dialog (modal): failed"),m.warn("\nprobably no|wrong `contentURL` set")})}}.bind(this))}function i(){var o=u.getSettings();if(o)for(var e in o){var t=u.$modal.find("#google-options .translator-option[data-name="+e+'] input[type="checkbox"]');t.prop("checked",o[e])}}function s(){b?(u.$buttonDoNotAgree.hide(),u.$buttonAgree.hide(),u.$buttonSave.show(),u.$buttonAgreeAll.show()):(u.$buttonDoNotAgree.show(),u.$buttonAgree.show(),u.$buttonSave.hide(),u.$buttonAgreeAll.hide())}function r(o){for(var e=u.$modal.find("#google-options .translator-option"),t={},n=0;n<e.length;n++){var a=e[n],i=a.getAttribute("data-name");if("necessary"===i)t[i]=!0;else if(void 0===o){var s=$(a).find('input[type="checkbox"]');t[i]=s.prop("checked")}else t[i]=!!o}return t}function l(){var o=r(!0),e={};e=JSON.parse(v.get(u.props.cookieConsentName)),e.analysis=o.analysis,e.personalization=o.personalization,v.set(u.props.cookieConsentName,JSON.stringify(e),u.props.cookieStorageDays,u.props.sameSite,u.props.secure),v.set(u.props.cookieName,JSON.stringify(o),u.props.cookieStorageDays,u.props.sameSite,u.props.secure),u.$modal.modal("hide")}function d(){var o=r();o.translationEnabled=!1,v.set(u.props.cookieName,JSON.stringify(o),u.props.cookieStorageDays,u.props.sameSite,u.props.secure),u.$modal.modal("hide")}function c(){var o,e={};o=r(),e=JSON.parse(v.get(u.props.cookieConsentName)),e.analysis=o.analysis,e.personalization=o.personalization,v.set(u.props.cookieConsentName,JSON.stringify(e),u.props.cookieStorageDays,u.props.sameSite,u.props.secure),v.set(u.props.cookieName,JSON.stringify(r()),u.props.cookieStorageDays,u.props.sameSite,u.props.secure),u.$modal.modal("hide")}var p,g,u=this,m=log4javascript.getLogger("j1.core.translator"),h=new liteURL(window.location.href),f=h.protocol.includes("https")?!0:!1,b=!1;this.props={contentURL:"/assets/data/translator",cookieName:"j1.user.state",cookieConsentName:"j1.user.consent",cookieStorageDays:365,cookieSameSite:"Strict",cookieSecure:f,translationEnabled:!1,disableLanguageSelector:!1,translatorName:"google",translationLanguages:"all",translationLanguage:"auto",translateAllPages:!0,hideSuggestionBox:!0,hidePoweredBy:!0,hideTopFrame:!0,dialogLanguage:"content",dialogLanguages:["en","de"],dialogContainerID:"translator-modal",xhrDataElement:"",postSelectionCallback:""};for(var S in o)this.props[S]=o[S];-1!==this.props.dialogLanguage.indexOf("-")&&(this.props.dialogLanguage=this.props.dialogLanguage.split("-")[0]),this.props.dialogLanguages.includes(this.props.dialogLanguage)||(this.props.dialogLanguage=this.props.dialogLanguages[0]),this.props.xhrDataElement=this.props.xhrDataElement+"-"+this.props.dialogLanguage,m.info("\ninitializing core module: started"),m.info("\nstate: started");var v={set:function(o,e,t,n,a){var i=window.btoa(e),s="";if(t){var r=new Date;r.setTime(r.getTime()+24*t*60*60*1e3),s="; expires="+r.toUTCString()}a?document.cookie=o+"="+(i||"")+s+"; Path=/; SameSite="+n+"; secure="+a+";":document.cookie=o+"="+(i||"")+s+"; Path=/; SameSite="+n+";"},get:function(o){for(var e=o+"=",t=document.cookie.split(";"),n=0;n<t.length;n++){for(var a=t[n];" "===a.charAt(0);)a=a.substring(1,a.length);if(0===a.indexOf(e)){var i=a.substring(e.length,a.length),s=window.atob(i);return s}}return void 0}},k={documentReady:function(o){"loading"!==document.readyState?o():document.addEventListener("DOMContentLoaded",o)}};this.showDialog=function(){a()},this.getSettings=function(o){var e=v.get(u.props.cookieName);if(e){var t=JSON.parse(v.get(u.props.cookieName));return void 0===o?t:t?t[o]:!1}return void 0},m.info("\ninitializing core module finished"),m.info("\nstate: finished")}
