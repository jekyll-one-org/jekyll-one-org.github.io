/*
 # -----------------------------------------------------------------------------
 # ~/assets/themes/j1/modules/translator/js/translator.min.js
 # Provides JS Core functions|API for J1 Module Translator
 #
 #  Product/Info:
 #  http://jekyll.one
 #
 #  Copyright (C) 2023 Juergen Adams
 #
 #  J1 Theme is licensed under MIT License.
 #  See: https://github.com/jekyll-one/J1 Theme/blob/master/LICENSE
 # -----------------------------------------------------------------------------
*/
"use strict";function Translator(o){var e,t,a=this,n=log4javascript.getLogger("j1.core.translator"),i=!!new liteURL(window.location.href).protocol.includes("https"),s=!1,r={set:function(o,e,t,a,n,i){var s=window.btoa(e),r="; expires=Thu, 01 Jan 1970 00:00:00 UTC";if(t>0){var l=new Date;l.setTime(l.getTime()+24*t*60*60*1e3),r="; expires="+l.toUTCString()}document.cookie=i?o+"="+(s||"")+r+"; Path=/; SameSite="+a+"; Domain="+n+"; Secure="+i+";":o+"="+(s||"")+r+"; Path=/; SameSite="+a+";Domain="+n+"; "},get:function(o){for(var e=o+"=",t=document.cookie.split(";"),a=0;a<t.length;a++){for(var n=t[a];" "===n.charAt(0);)n=n.substring(1,n.length);if(0===n.indexOf(e)){var i=n.substring(e.length,n.length);return window.atob(i)}}}};for(var l in n.info("\ninitializing core module: started"),n.info("\nstate: started"),this.props={contentURL:"/assets/data/translator",cookieName:"j1.user.state",cookieConsentName:"j1.user.consent",cookieStorageDays:365,cookieSameSite:"Lax",cookieSecure:i,translationEnabled:!1,disableLanguageSelector:!1,translatorName:"google",translationLanguages:"all",translationLanguage:"auto",translateAllPages:!0,hideSuggestionBox:!0,hidePoweredBy:!0,hideTopFrame:!0,dialogLanguage:"content",dialogLanguages:["en","de"],dialogContainerID:"translator-modal",xhrDataElement:"",postSelectionCallback:""},o)this.props[l]=o[l];-1!==this.props.dialogLanguage.indexOf("-")&&(this.props.dialogLanguage=this.props.dialogLanguage.split("-")[0]),this.props.dialogLanguages.includes(this.props.dialogLanguage)||(this.props.dialogLanguage=this.props.dialogLanguages[0]),this.props.xhrDataElement=this.props.xhrDataElement+"-"+this.props.dialogLanguage,n.info("\ninitializing core module: started"),n.info("\nstate: started");r.get(a.props.cookieName)||(n.info("\ninitializing translator cookie: "+a.props.cookieName),r.set(a.props.cookieName,JSON.stringify({translatorName:"google",translationEnabled:!1,translateAllPages:!0,useLanguageFromBrowser:!0,translationLanguage:"de",analysis:!0,personalization:!0}),a.props.cookieStorageDays,a.props.cookieSameSite,a.props.cookieDomain,a.props.cookieSecure));var d={documentReady:function(o){"loading"!==document.readyState?o():document.addEventListener("DOMContentLoaded",o)}};function p(o){var e,t=function o(){var e={},t=!1,a=0,n=arguments.length;"[object Boolean]"===Object.prototype.toString.call(arguments[0])&&(t=arguments[0],a++);for(var i=function(a){for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(t&&"[object Object]"===Object.prototype.toString.call(a[n])?e[n]=o(!0,e[n],a[n]):e[n]=a[n])};a<n;a++)i(arguments[a]);return e}({size:0,width:250,multiple:!1,selectedIndex:1,enableAutoFilter:!1,visibleRows:null},o);e="#"+t.selector,$.ajax({url:t.url,dataType:"json",success:function(o){var n=[];if(a.props.translationLanguages.includes("all"))n=o[t.elm];else for(var i=0;i<o[t.elm].length;i++)a.props.translationLanguages.includes(o[t.elm][i].value)&&n.push(o[t.elm][i]);t.visibleRows>n.length&&(t.visibleRows=n.length),MsDropdown.make(e,{byJson:{data:n,name:t.name,size:t.size,width:t.width,multiple:t.multiple},enableAutoFilter:t.enableAutoFilter,visibleRows:t.visibleRows})},error:function(o,e,a){n.error("\nfailed to retrieve JSON data from: "+t.url)}})}function c(){d.documentReady(function(){if(a.modal=document.getElementById(a.props.dialogContainerID),a.modal)a.$modal.modal("show");else{n.info("\nload consent modal"),a.modal=document.createElement("div"),a.modal.id=a.props.dialogContainerID,a.modal.style.display="none",a.modal.setAttribute("class","modal fade"),a.modal.setAttribute("tabindex","-1"),a.modal.setAttribute("role","dialog"),a.modal.setAttribute("aria-labelledby",a.props.dialogContainerID),document.body.append(a.modal),a.$modal=$(a.modal),a.$modal.on("show.bs.modal",function(){n.debug("\nshow.bs.modal: entered"),$.when(p({url:"/assets/data/iso-639-language-codes-flags.json",elm:"iso-639-languages",selector:"dropdownJSON",width:400,visibleRows:8})).then(function(o){n.info("\ncreating msDropdown from JSON data: finished")})}),a.$modal.on("shown.bs.modal",function(){var o,i;i=setInterval(function(){void 0!==document.getElementById("dropdownJSON").msDropdown&&((o=document.getElementById("dropdownJSON").msDropdown).length?("auto"===a.props.translationLanguage?(e=navigator.language||navigator.userLanguage,t=e.split("-")[0]):t=a.props.translationLanguage,o.selectedIndex=$("#dropdownJSON option[value="+t+"]").index(),a.props.disableLanguageSelector&&(o.disabled=!0),$("#dropdownJSON").show(),$("body").addClass("stop-scrolling"),n.info("\nmsDropdown successfully loaded in translation dialog"),clearInterval(i)):(n.error("\nno msDropdown found in translation dialog"),a.$modal.hide()))},25)}),a.$modal.on("hidden.bs.modal",function(){$("body").removeClass("stop-scrolling"),function(o,e){for(var t=Array.prototype.slice.call(arguments,2),a=o.split("."),n=a.pop(),i=0;i<a.length;i++)e=e[a[i]];e[n].apply(e,t)}(a.props.postSelectionCallback,window)});var o=a.props.contentURL+"/index.html";$.get(o).done(function(o){n.info("\nloading consent modal: successfully"),a.modal.innerHTML=o,a.modal.innerHTML=$("#"+a.props.xhrDataElement).eq(0).html(),a.modal.style.display="block",$(a.modal).modal({backdrop:"static",keyboard:!1}),a.$buttonDoNotAgree=$("#translator-buttonDoNotAgree"),a.$buttonAgree=$("#translator-buttonAgree"),a.$buttonSave=$("#translator-buttonSave"),a.$buttonAgreeAll=$("#translator-buttonAgreeAll"),n.info("\nload/initialze options from cookie"),u(),g(),$("#google-options").on("hide.bs.collapse",function(){s=!1,u()}).on("show.bs.collapse",function(){s=!0,u()}),n.info("\ninitialze button event handler"),a.$buttonDoNotAgree.click(function(){var o;(o=m()).translationEnabled=!1,r.set(a.props.cookieName,JSON.stringify(o),a.props.cookieStorageDays,a.props.cookieSameSite,a.props.cookieDomain,a.props.cookieSecure),a.$modal.modal("hide")}),a.$buttonAgree.click(function(){f()}),a.$buttonSave.click(function(){var o,e;$("#google-options").collapse("hide"),o=m(),(e=JSON.parse(r.get(a.props.cookieConsentName))).analysis=o.analysis,e.personalization=o.personalization,r.set(a.props.cookieConsentName,JSON.stringify(e),a.props.cookieStorageDays,a.props.cookieSameSite,a.props.cookieDomain,a.props.cookieSecure),r.set(a.props.cookieName,JSON.stringify(o),a.props.cookieStorageDays,a.props.cookieSameSite,a.props.cookieDomain,a.props.cookieSecure),a.$modal.modal("hide"),g()}),a.$buttonAgreeAll.click(function(){$("#google-options").collapse("hide"),f()}),a.$modal.modal("show")}).fail(function(){n.error("\nloading translator dialog (modal): failed"),n.warn("\nprobably no|wrong `contentURL` set")})}}.bind(this))}function g(){var o=a.getSettings();if(o)for(var e in o){a.$modal.find("#google-options .translator-option[data-name="+e+'] input[type="checkbox"]').prop("checked",o[e])}}function u(){s?(a.$buttonDoNotAgree.hide(),a.$buttonAgree.hide(),a.$buttonSave.show(),a.$buttonAgreeAll.show()):(a.$buttonDoNotAgree.show(),a.$buttonAgree.show(),a.$buttonSave.hide(),a.$buttonAgreeAll.hide())}function m(o){for(var e=a.$modal.find("#google-options .translator-option"),t={},n=0;n<e.length;n++){var i=e[n],s=i.getAttribute("data-name");if("necessary"===s)t[s]=!0;else if(void 0===o){var r=$(i).find('input[type="checkbox"]');t[s]=r.prop("checked")}else t[s]=!!o}return t}function f(){var o=JSON.parse(r.get(a.props.cookieConsentName)),e=JSON.parse(r.get(a.props.cookieName));e.analysis=!0,e.personalization=!0,e.translationEnabled=!0,o.analysis=e.analysis,o.personalization=e.personalization,r.set(a.props.cookieConsentName,JSON.stringify(o),a.props.cookieStorageDays,a.props.cookieSameSite,a.props.cookieDomain,a.props.cookieSecure),r.set(a.props.cookieName,JSON.stringify(e),a.props.cookieStorageDays,a.props.cookieSameSite,a.props.cookieDomain,a.props.cookieSecure),a.$modal.modal("hide")}this.showDialog=function(){c()},this.getSettings=function(o){if(r.get(a.props.cookieName)){var e=JSON.parse(r.get(a.props.cookieName));return void 0===o?e:!!e&&e[o]}},n.info("\ninitializing core module finished"),n.info("\nstate: finished")}
