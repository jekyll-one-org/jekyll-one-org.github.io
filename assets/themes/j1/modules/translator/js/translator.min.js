/*
 # -----------------------------------------------------------------------------
 # ~/assets/themes/j1/modules/translator/js/translator.min.js
 # Provides JS Core functions|API for J1 Module Translator
 #
 #  Product/Info:
 #  http://jekyll.one
 #
 #  Copyright (C) 2023 Juergen Adams
 #
 #  J1 Theme is licensed under MIT License.
 #  See: https://github.com/jekyll-one/J1 Theme/blob/master/LICENSE
 # -----------------------------------------------------------------------------
*/
"use strict";function Translator(o){var e,a,t=this,n=log4javascript.getLogger("j1.core.translator"),i=!!new liteURL(window.location.href).protocol.includes("https"),s=!1,r={set:function(o,e,a,t,n,i){var s=window.btoa(e),r="; expires=Thu, 01 Jan 1970 00:00:00 UTC";if(a>0){var l=new Date;l.setTime(l.getTime()+864e5*a),r="; expires="+l.toUTCString()}i?n?document.cookie=o+"="+(s||"")+r+"; Path=/; SameSite="+t+"; Domain="+n+"; Secure="+i+";":document.cookie=o+"="+(s||"")+r+"; Path=/; SameSite="+t+"; Secure="+i+";":n?document.cookie=o+"="+(s||"")+r+"; Path=/; SameSite="+t+";Domain="+n+"; ":document.cookie=o+"="+(s||"")+r+"; Path=/; SameSite="+t+";"},get:function(o){for(var e=o+"=",a=document.cookie.split(";"),t=0;t<a.length;t++){for(var n=a[t];" "===n.charAt(0);)n=n.substring(1,n.length);if(0===n.indexOf(e)){var i=n.substring(e.length,n.length);return window.atob(i)}}}};for(var l in this.props={contentURL:"/assets/data/translator",cookieName:"j1.user.state",cookieConsentName:"j1.user.consent",cookieStorageDays:365,cookieSameSite:"Lax",cookieSecure:i,translationEnabled:!1,disableLanguageSelector:!1,translatorName:"google",translationLanguages:"all",translationLanguage:"auto",translateAllPages:!0,hideSuggestionBox:!0,hidePoweredBy:!0,hideTopFrame:!0,dialogLanguage:"content",dialogLanguages:["en","de"],dialogContainerID:"translator-modal",xhrDataElement:"",postSelectionCallback:""},o)this.props[l]=o[l];-1!==this.props.dialogLanguage.indexOf("-")&&(this.props.dialogLanguage=this.props.dialogLanguage.split("-")[0]),this.props.dialogLanguages.includes(this.props.dialogLanguage)||(this.props.dialogLanguage=this.props.dialogLanguages[0]),this.props.xhrDataElement=this.props.xhrDataElement+"-"+this.props.dialogLanguage,n.info("\ninitializing core module: started"),n.debug("\nstate: started"),r.get(t.props.cookieName)||(n.info("\ninitializing translator cookie: "+t.props.cookieName),r.set(t.props.cookieName,JSON.stringify({translatorName:"google",translationEnabled:!1,translateAllPages:!0,useLanguageFromBrowser:!0,translationLanguage:"de",analysis:!0,personalization:!0}),t.props.cookieStorageDays,t.props.cookieSameSite,t.props.cookieDomain,t.props.cookieSecure));var p={documentReady:function(o){"loading"!==document.readyState?o():document.addEventListener("DOMContentLoaded",o)}};function d(){var o=t.getSettings();if(o)for(var e in o)t.$modal.find("#google-options .translator-option[data-name="+e+'] input[type="checkbox"]').prop("checked",o[e])}function g(){s?(t.$buttonDoNotAgree.hide(),t.$buttonAgree.hide(),t.$buttonSave.show(),t.$buttonAgreeAll.show()):(t.$buttonDoNotAgree.show(),t.$buttonAgree.show(),t.$buttonSave.hide(),t.$buttonAgreeAll.hide())}function c(o){for(var e=t.$modal.find("#google-options .translator-option"),a={},n=0;n<e.length;n++){var i=e[n],s=i.getAttribute("data-name");if("necessary"===s)a[s]=!0;else if(void 0===o){var r=$(i).find('input[type="checkbox"]');a[s]=r.prop("checked")}else a[s]=!!o}return a}function u(){var o=JSON.parse(r.get(t.props.cookieConsentName)),e=JSON.parse(r.get(t.props.cookieName));e.analysis=!0,e.personalization=!0,e.translationEnabled=!0,o.analysis=e.analysis,o.personalization=e.personalization,r.set(t.props.cookieConsentName,JSON.stringify(o),t.props.cookieStorageDays,t.props.cookieSameSite,t.props.cookieDomain,t.props.cookieSecure),r.set(t.props.cookieName,JSON.stringify(e),t.props.cookieStorageDays,t.props.cookieSameSite,t.props.cookieDomain,t.props.cookieSecure),t.$modal.modal("hide")}this.showDialog=function(){!function o(){p.documentReady((function(){if(t.modal=document.getElementById(t.props.dialogContainerID),t.modal)t.$modal.modal("show");else{n.info("\nload consent modal"),t.modal=document.createElement("div"),t.modal.id=t.props.dialogContainerID,t.modal.style.display="none",t.modal.setAttribute("class","modal fade"),t.modal.setAttribute("tabindex","-1"),t.modal.setAttribute("role","dialog"),t.modal.setAttribute("aria-labelledby",t.props.dialogContainerID),document.body.append(t.modal),t.$modal=$(t.modal),t.$modal.on("show.bs.modal",function(){var o,e,a;n.debug("\nshow.bs.modal: entered"),$.when(void(e="#"+(a=function o(){var e={},a=!1,t=0,n=arguments.length;for("[object Boolean]"===Object.prototype.toString.call(arguments[0])&&(a=arguments[0],t++);t<n;t++){var i=arguments[t];!function(t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(a&&"[object Object]"===Object.prototype.toString.call(t[n])?e[n]=o(!0,e[n],t[n]):e[n]=t[n])}(i)}return e}({size:0,width:250,multiple:!1,selectedIndex:1,enableAutoFilter:!1,visibleRows:null},o={url:"/assets/data/iso-639-language-codes-flags.json",elm:"iso-639-languages",selector:"dropdownJSON",width:400,visibleRows:8})).selector,$.ajax({url:a.url,dataType:"json",success:function(o){var n=[];if(t.props.translationLanguages.includes("all"))n=o[a.elm];else for(var i=0;i<o[a.elm].length;i++)t.props.translationLanguages.includes(o[a.elm][i].value)&&n.push(o[a.elm][i]);a.visibleRows>n.length&&(a.visibleRows=n.length),MsDropdown.make(e,{byJson:{data:n,name:a.name,size:a.size,width:a.width,multiple:a.multiple},enableAutoFilter:a.enableAutoFilter,visibleRows:a.visibleRows})},error:function(o,e,t){n.error("\nfailed to retrieve JSON data from: "+a.url)}}))).then(function(o){n.info("\ncreating msDropdown from JSON data: finished")})}),t.$modal.on("shown.bs.modal",function(){var o,i;i=setInterval(function(){void 0!==document.getElementById("dropdownJSON").msDropdown&&((o=document.getElementById("dropdownJSON").msDropdown).length?(a="auto"===t.props.translationLanguage?(e=navigator.language||navigator.userLanguage).split("-")[0]:t.props.translationLanguage,o.selectedIndex=$("#dropdownJSON option[value="+a+"]").index(),t.props.disableLanguageSelector&&(o.disabled=!0),$("#dropdownJSON").show(),$("body").addClass("stop-scrolling"),n.info("\nmsDropdown successfully loaded in translation dialog"),clearInterval(i)):(n.error("\nno msDropdown found in translation dialog"),t.$modal.hide()))},10)}),t.$modal.on("hidden.bs.modal",function(){$("body").removeClass("stop-scrolling"),function o(e,a){for(var t=Array.prototype.slice.call(arguments,2),n=e.split("."),i=n.pop(),s=0;s<n.length;s++)a=a[n[s]];return a[i].apply(a,t)}(t.props.postSelectionCallback,window)});var o=t.props.contentURL+"/index.html";$.get(o).done(function(o){n.info("\nloading consent modal: successfully"),t.modal.innerHTML=o,t.modal.innerHTML=$("#"+t.props.xhrDataElement).eq(0).html(),t.modal.style.display="block",$(t.modal).modal({backdrop:"static",keyboard:!1}),t.$buttonDoNotAgree=$("#translator-buttonDoNotAgree"),t.$buttonAgree=$("#translator-buttonAgree"),t.$buttonSave=$("#translator-buttonSave"),t.$buttonAgreeAll=$("#translator-buttonAgreeAll"),n.info("\nload/initialze options from cookie"),g(),d(),$("#google-options").on("hide.bs.collapse",function(){s=!1,g()}).on("show.bs.collapse",function(){s=!0,g()}),n.info("\ninitialze button event handler"),t.$buttonDoNotAgree.click(function(){var o;o=c(),o.translationEnabled=!1,r.set(t.props.cookieName,JSON.stringify(o),t.props.cookieStorageDays,t.props.cookieSameSite,t.props.cookieDomain,t.props.cookieSecure),t.$modal.modal("hide")}),t.$buttonAgree.click(function(){u()}),t.$buttonSave.click(function(){var o,e;$("#google-options").collapse("hide"),o=c(),(e=JSON.parse(r.get(t.props.cookieConsentName))).analysis=o.analysis,e.personalization=o.personalization,r.set(t.props.cookieConsentName,JSON.stringify(e),t.props.cookieStorageDays,t.props.cookieSameSite,t.props.cookieDomain,t.props.cookieSecure),r.set(t.props.cookieName,JSON.stringify(o),t.props.cookieStorageDays,t.props.cookieSameSite,t.props.cookieDomain,t.props.cookieSecure),t.$modal.modal("hide"),d()}),t.$buttonAgreeAll.click(function(){$("#google-options").collapse("hide"),u()}),t.$modal.modal("show")}).fail(function(){n.error("\nloading translator dialog (modal): failed"),n.warn("\nprobably no|wrong `contentURL` set")})}}).bind(this))}()},this.getSettings=function(o){if(r.get(t.props.cookieName)){var e=JSON.parse(r.get(t.props.cookieName));return void 0===o?e:!!e&&e[o]}},n.info("\ninitializing core module finished"),n.debug("\nstate: finished")}
